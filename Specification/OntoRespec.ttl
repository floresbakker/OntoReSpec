@prefix condition: <https://data.rijksfinancien.nl/html/model/condition/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>.
@prefix doc: <http://www.example.org/document/> .
@prefix function: <https://data.rijksfinancien.nl/html/model/function/>.
@prefix html: <https://data.rijksfinancien.nl/html/model/def/> .
@prefix manchester: <https://data.rijksfinancien.nl/manchester/model/def/> .
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix respec: <https://respec.org/model/def/> .
@prefix rule: <https://data.rijksfinancien.nl/html/model/rule/>.
@prefix shp: <https://data.rijksfinancien.nl/html/model/shp/>.
@prefix target: <https://data.rijksfinancien.nl/html/model/target/>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.

respec:introduction
    a owl:DatatypeProperty;
    rdfs:domain respec:Generation;
    rdfs:range xsd:string;
    skos:definition 'Property that links a text, in which an ontology is presented and introduced to an audience, to that very ontology.'@en;
    skos:prefLabel 'has introduction'@en.

shp:Document
  a sh:NodeShape;
  sh:rule rule:Document, rule:StaticElement, rule:Title, rule:Introduction, rule:Description, rule:Example, rule:NameSpace, rule:Abstract, rule:Configuration, rule:Classes, rule:ObjectProperties, rule:DatatypeProperties, rule:RDF_Properties, rule:NodeShapes, rule:NamedIndividuals, rule:Concepts, rule:ConceptSchemes;
  sh:targetClass respec:Generation.

rule:Document
  a sh:SPARQLRule;
  skos:prefLabel 'Document rule'@en;
  rdfs:comment 'The Document rule creates a document and attaches its structure.'@en ;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/> 
prefix prov: <http://www.w3.org/ns/prov#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix respec: <https://respec.org/model/def/> 

construct {
  ?documentID
    a html:Document, respec:Document ;
    ?element ?childID ;
    prov:wasGeneratedBy $this;
    dct:subject ?ontology.
    
} where {
  
  $this dct:subject ?ontology;
        respec:documentNamespace ?namespace.
  ?template         rdf:type respec:Template;
                    ?element ?child.
  ?child  a/ rdfs:subClassOf* dom:Element.
  
  # Create identifiers
  bind(iri(concat(str(?template),'-instance')) as ?documentID)
  bind(iri(concat(str(?child),'-instance')) as ?childID)
  
}""".

rule:StaticElement
  a sh:SPARQLRule;
  skos:prefLabel 'Static Element rule'@en;
  rdfs:comment 'The Static Element rule creates a unique element and attaches its structure.'@en ;
  sh:construct """
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/> 
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix respec: <https://respec.org/model/def/> 

construct {
  ?elementID
    a ?class ;
    rdfs:label ?label;
    html:fragment ?fragment;
    ?element ?childID ;
    ?attribute ?attributeValue.

} where {

  $this respec:documentLanguage ?language;
        respec:documentNamespace ?namespace.
  ?templateClass a ?class,
          respec:StaticElement.
  
  OPTIONAL {
  ?templateClass ?element ?child.
  ?child  a/ rdfs:subClassOf* dom:Element.}
  
  OPTIONAL {
  ?templateClass html:fragment ?fragment}
  
  OPTIONAL {
  ?templateClass rdfs:label ?label
  FILTER (LANG(?label) = ?language)
  }
  
  OPTIONAL {
  ?templateClass ?attribute ?attributeValue.
  ?attribute rdfs:subPropertyOf html:attribute.
  }
  ?class rdfs:subClassOf* dom:Element.
  
  # Create identifiers
  bind(iri(concat(str(?templateClass),'-instance')) as ?elementID)
  bind(iri(concat(str(?child),'-instance')) as ?childID)
  
}""".

rule:Title
  a sh:SPARQLRule;
  skos:prefLabel 'Title rule'@en;
  rdfs:comment 'The Title rule creates a title for the ontology in the document.'@en ;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/> 
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix respec: <https://respec.org/model/def/> 
prefix schema: <http://schema.org/>

construct {
  ?titleID rdf:type html:TextElement;
  html:fragment ?ontologyTitle.
    
} where {
   {?template a respec:Title}
  OPTIONAL
  {$this dct:subject ?ontology;
         respec:documentLanguage ?language.
  ?ontology dc:title ?ontologyTitle1.
  FILTER(LANG(?ontologyTitle1)=?language)}
  OPTIONAL
  {$this dct:subject ?ontology;
         respec:documentLanguage ?language.
  ?ontology dct:title ?ontologyTitle2.
  FILTER(LANG(?ontologyTitle2)=?language)}
  OPTIONAL
  {$this dct:subject ?ontology;
         respec:documentLanguage ?language.
  ?ontology schema:name ?ontologyTitle3.
  FILTER(LANG(?ontologyTitle3)=?language)}
   
  BIND(COALESCE(?ontologyTitle1, ?ontologyTitle2, ?ontologyTitle3, "Unknown title") as ?ontologyTitle)
  # Create identifiers
  bind(iri(concat(str(?template),'-instance')) as ?titleID)
    
}""".

rule:Introduction
  a sh:SPARQLRule;
  skos:prefLabel 'Introduction rule'@en;
  rdfs:comment 'The Introduction rule creates an introduction for the ontology in the document.'@en ;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/> 
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix respec: <https://respec.org/model/def/> 
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>

construct {
  ?introductionSectionInstance        rdf:type html:Section;
                                      rdf:_1 ?generalIntroductionH2;
                                      rdf:_2 ?generalIntroduction_text;
                                      rdf:_3 ?introductionBackgroundSection;
                                      rdf:_4 ?introductionOntologySection;
                                      rdf:_5 ?introductionAudienceSection;
                                      html:class "informative".
  ?generalIntroductionH2              rdf:type html:H2;
                                      rdf:_1 ?generalIntroduction_title.
  ?generalIntroduction_title          rdf:type html:TextElement;
                                      html:fragment "Introduction".
  ?generalIntroduction_text           rdf:type html:TextElement;
                                      html:fragment ?generalIntroduction.
  ?introductionBackgroundSection      rdf:type html:Section;
                                      rdf:_1 ?introductionBackgroundH2;
                                      rdf:_2 ?introductionBackground_text.
  ?introductionBackgroundH2           rdf:type html:H2;
                                      rdf:_1 ?introductionBackground_title.
  ?introductionBackground_title       rdf:type html:TextElement;
                                      html:fragment "Background".
  ?introductionBackground_text        rdf:type html:TextElement;
                                      html:fragment ?introductionBackground.	
  ?introductionOntologySection        rdf:type html:Section;
                                      rdf:_1 ?introductionOntologyH2;
                                      rdf:_2 ?introductionOntology_text.
  ?introductionOntologyH2             rdf:type html:H2;
                                      rdf:_1 ?introductionOntology_title.
  ?introductionOntology_title         rdf:type html:TextElement;
                                      html:fragment "Objective".
  ?introductionOntology_text          rdf:type html:TextElement;
                                      html:fragment ?introductionObjective.
  ?introductionAudienceSection        rdf:type html:Section;
                                      rdf:_1 ?introductionAudienceH2;
                                      rdf:_2 ?introductionAudience_text.
  ?introductionAudienceH2             rdf:type html:H2;
                                      rdf:_1 ?introductionAudience_title.
  ?introductionAudience_title         rdf:type html:TextElement;
                                      html:fragment "Audience".
  ?introductionAudience_text          rdf:type html:TextElement;
                                      html:fragment ?introductionAudience.
} where {

   {$this respec:documentLanguage ?language.
   ?introductionSection a respec:Introduction}
   OPTIONAL
   {$this respec:introduction ?introduction.
   FILTER (LANG(?introduction) = ?language)}
   OPTIONAL
   {$this respec:background ?background.
   FILTER (LANG(?background) = ?language)}
   OPTIONAL
   {$this respec:objective ?objective.
   FILTER (LANG(?objective) = ?language)}
   OPTIONAL
   {$this respec:audience ?audience.
   FILTER (LANG(?audience) = ?language)}
    
  BIND(COALESCE(?introduction, "This specification document does not describe an introduction to the ontology.") as ?generalIntroduction) 
  BIND(COALESCE(?background, "This specification document does not describe the background of the ontology.") as ?introductionBackground) 
  BIND(COALESCE(?objective, "This specification document does not define the objective of the ontology.") as ?introductionObjective) 
  BIND(COALESCE(?audience, "This specification document does not describe the intended audience of the ontology.") as ?introductionAudience) 
  
  # Create identifiers
  bind(iri(concat(str(?introductionSection),'-instance')) as ?introductionSectionInstance)
  bind(iri(concat(str(?introductionSectionInstance),'-1')) as ?generalIntroductionH2 )
  bind(iri(concat(str(?introductionSectionInstance),'-2')) as ?generalIntroduction_text)
  bind(iri(concat(str(?generalIntroductionH2 ),'-1')) as ?generalIntroduction_title )
    
  bind(iri(concat(str(?introductionSectionInstance),'-3')) as ?introductionBackgroundSection )
  bind(iri(concat(str(?introductionBackgroundSection),'-1')) as ?introductionBackgroundH2)
  bind(iri(concat(str(?introductionBackgroundSection),'-2')) as ?introductionBackground_text)
  bind(iri(concat(str(?introductionBackgroundH2),'-1')) as ?introductionBackground_title)
  
  bind(iri(concat(str(?introductionSectionInstance),'-4')) as ?introductionOntologySection )
  bind(iri(concat(str(?introductionOntologySection),'-1')) as ?introductionOntologyH2)
  bind(iri(concat(str(?introductionOntologySection),'-2')) as ?introductionOntology_text)
  bind(iri(concat(str(?introductionOntologyH2),'-1')) as ?introductionOntology_title)
  
  bind(iri(concat(str(?introductionSectionInstance),'-5')) as ?introductionAudienceSection )
  bind(iri(concat(str(?introductionAudienceSection),'-1')) as ?introductionAudienceH2)
  bind(iri(concat(str(?introductionAudienceSection),'-2')) as ?introductionAudience_text)
  bind(iri(concat(str(?introductionAudienceH2),'-1')) as ?introductionAudience_title)
  
}""".

rule:Description
  a sh:SPARQLRule;
  skos:prefLabel 'Description rule'@en;
  rdfs:comment 'The Description rule creates a description for the ontology in the document.'@en ;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/> 
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix respec: <https://respec.org/model/def/> 
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>

construct {
  ?descriptionTextElementID rdf:type html:TextElement;
  html:fragment ?ontologyDescription.
    
} where {
   {?textElement a respec:Overview.
   $this respec:documentLanguage ?language;
         dct:subject ?ontology.}
  OPTIONAL
  {?ontology dc:description ?ontologyDescription1
  FILTER (LANG(?ontologyDescription1) = ?language)}
  OPTIONAL
  {?ontology dct:description ?ontologyDescription2
  FILTER (LANG(?ontologyDescription2) = ?language)}
  OPTIONAL
  {?ontology rdfs:comment ?ontologyDescription3
  FILTER (LANG(?ontologyDescription3) = ?language)}
  OPTIONAL
  {?ontology schema:description ?ontologyDescription4
  FILTER (LANG(?ontologyDescription4) = ?language)}
  OPTIONAL
  {?ontology skos:note ?ontologyDescription5
  FILTER (LANG(?ontologyDescription5) = ?language)}

  BIND(COALESCE(?ontologyDescription1, ?ontologyDescription2, ?ontologyDescription3, ?ontologyDescription4, ?ontologyDescription5,"Description not available") as ?ontologyDescription)
  # Create identifiers
  bind(iri(concat(str(?textElement),'-instance')) as ?descriptionTextElementID)
    
}""".

rule:Example
  a sh:SPARQLRule;
  skos:prefLabel 'Example rule'@en;
  rdfs:comment 'The Example rule creates an example for the ontology in the document.'@en ;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/> 
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix respec: <https://respec.org/model/def/> 
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>

construct {
  ?exampleElementAside   rdf:type html:Aside;
                         html:class 'example';
                         rdf:_1 ?exampleParagraph.
  ?exampleParagraph      rdf:type html:P;
                         rdf:_1 ?examplePre.
  ?examplePre            rdf:type html:Pre;
                         rdf:_1 ?exampleTextElement.
  ?exampleTextElement    rdf:type html:TextElement;
                         html:fragment ?ontologyExample.
} where {
  
  ?exampleElement a respec:Example.
  $this respec:documentLanguage ?language;
        dct:subject ?ontology.
  ?ontology skos:example ?example.
  FILTER (LANG(?example) = ?language)
  BIND(function:escapeHTML(?example) as ?ontologyExample)
  
  # Create identifiers
  BIND(IRI(CONCAT(STR(?exampleElement),'-instance')) as ?exampleElementAside)
  BIND(IRI(CONCAT(STR(?exampleElementAside), '-1')) as ?exampleParagraph)
  BIND(IRI(CONCAT(STR(?exampleParagraph),'-1')) as ?examplePre)
  BIND(IRI(CONCAT(STR(?examplePre),'-1')) as ?exampleTextElement)
    
}""".

rule:NameSpace
  a sh:SPARQLRule;
  skos:prefLabel 'Namespace rule'@en;
  rdfs:comment 'The Namespace rule creates a namespace declaration for the ontology in the document.'@en ;
  sh:construct """
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX html: <https://data.rijksfinancien.nl/html/model/def/> 
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX respec: <https://respec.org/model/def/> 
PREFIX sh: <http://www.w3.org/ns/shacl#>
PREFIX vann: <http://purl.org/vocab/vann/>

construct {
  ?namespaceTableBodyInstance       ?rdf_member ?namespaceTableDataRow.
  ?namespaceTableDataRow            rdf:type html:Row;
                                    rdf:_1 ?namespacePrefixDataCell;
                                    rdf:_2 ?namespaceIRIDataCell.
  ?namespacePrefixDataCell          rdf:type html:DataCell;
                                    rdf:_1 ?namespacePrefixDataCell_text.
  ?namespacePrefixDataCell_text     rdf:type html:TextElement;
                                    html:fragment ?prefix.
  ?namespaceIRIDataCell             rdf:type html:DataCell;
                                    rdf:_1 ?namespaceIRIDataCell_text.
  ?namespaceIRIDataCell_text        rdf:type html:TextElement;
                                    html:fragment ?namespace.

} where {
  ?template a respec:NameSpace.
  {
  SELECT ?prefix ?namespace (COUNT(?prevPrefix) + 2 AS ?member) WHERE {

  # Get the namespace declarations for the ontology ordered by prefix
  
     {$this dct:subject ?ontology.
      ?ontology sh:declare ?prefixDeclaration.
      ?prefixDeclaration sh:namespace ?namespace;
                         # e.g. "http://example.org/"
                         sh:prefix ?prefix.
      # e.g. "ex"
    }
    UNION 

    # Get the namespace declaration for the ontology itself
    {
      $this dct:subject ?ontology.
      ?ontology vann:preferredNamespaceUri ?namespace;
                # e.g. "http://example.org/"
                vann:preferredNamespacePrefix ?prefix.
      # e.g. "ex"
    }
  
  OPTIONAL{
    {
      ?prevOntology sh:declare ?prevPrefixDeclaration.
      ?prevPrefixDeclaration sh:namespace ?prevNamespace;
                             # e.g. "http://example.org/"
                             sh:prefix ?prevPrefix.
      # e.g. "ex"
    }
    UNION 

    {
      ?prevOntology vann:preferredNamespaceUri ?prevNamespace;
                    # e.g. "http://example.org/"
                    vann:preferredNamespacePrefix ?prevPrefix.
      # e.g. "ex"
    }
    FILTER (?prevPrefix < ?prefix)
  }
}
GROUP BY ?prefix ?namespace
ORDER BY ?prefix}

BIND(IRI(CONCAT(str(rdf:),"_", str(?member))) as ?rdf_member)
# Create identifiers
BIND(IRI(CONCAT(STR(?template),'-instance'))                            as ?namespaceTableBodyInstance)
BIND(IRI(CONCAT(STR(?namespaceTableBodyInstance), '-',STR(?member)))    as ?namespaceTableDataRow)
BIND(IRI(CONCAT(STR(?namespaceTableDataRow),'-1'))                      as ?namespacePrefixDataCell)
BIND(IRI(CONCAT(STR(?namespaceTableDataRow),'-2'))                      as ?namespaceIRIDataCell)
BIND(IRI(CONCAT(STR(?namespacePrefixDataCell),'-1'))                    as ?namespacePrefixDataCell_text)
BIND(IRI(CONCAT(STR(?namespaceIRIDataCell),'-1'))                       as ?namespaceIRIDataCell_text)
}
""".

rule:Abstract
  a sh:SPARQLRule;
  skos:prefLabel 'Abstract rule'@en;
  rdfs:comment 'The Abstract rule creates an abstract for the ontology in the document.'@en ;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/> 
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix respec: <https://respec.org/model/def/> 

construct {
  ?abstractTextElementID rdf:type html:TextElement;
  html:fragment ?ontologyAbstract.
    
} where {
   {?textElement a respec:Abstract.
    $this respec:documentLanguage ?language;
          dct:subject ?ontology.}
  OPTIONAL
  {?ontology dc:abstract ?ontologyAbstract1
  FILTER (LANG(?ontologyAbstract1) = ?language)}
  OPTIONAL
  {?ontology dct:abstract ?ontologyAbstract2
  FILTER (LANG(?ontologyAbstract2) = ?language)}
  BIND(COALESCE(?ontologyAbstract1, ?ontologyAbstract2, "Abstract not available") as ?ontologyAbstract)
  # Create identifiers
  bind(iri(concat(str(?textElement),'-instance')) as ?abstractTextElementID)
    
}""".       
    

rule:Configuration
  a sh:SPARQLRule;
  skos:prefLabel 'Configuration rule'@en;
  rdfs:comment 'The Configuration rule creates the configuration information for the ontology in the document.'@en ;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/> 
prefix owl: <http://www.w3.org/2002/07/owl#>
prefix prov: <http://www.w3.org/ns/prov#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix respec: <https://respec.org/model/def/> 
prefix schema: <http://schema.org/>

construct {
  
  ?configurationElementID rdf:type html:TextElement;
  html:fragment ?fragment4.
    
} where {
  
  ?textElement a respec:Configuration;
               html:fragment ?fragment.
  $this respec:documentLanguage ?language;
        dct:subject ?ontology.
  optional
  {?ontology owl:versionIRI ?ontologyVersion1}
  optional
  {?ontology schema:schemaVersion ?ontologyVersion2}
  optional
  {?ontology owl:versionInfo ?ontologyVersionText1}
  optional
  {?ontology dct:publisher ?workinggroup}
  optional
  {?ontology dct:source ?github}
  { select (group_concat(?ontologyAuthorString;separator='') as ?ontologyAuthors) 
    {
  optional
  {?ontology dct:creator ?ontologyAuthor1}
  optional
  {?ontology dc:creator ?ontologyAuthor2}
  optional
  {?ontology schema:creator ?ontologyAuthor3}
  optional
  {?ontology prov:wasAttributedTo ?ontologyAuthor4}

  BIND(COALESCE(?ontologyAuthor1, ?ontologyAuthor2, ?ontologyAuthor3, ?ontologyAuthor4, "Author unknown") as ?ontologyAuthor)
  BIND(CONCAT('{name: "', STR(?ontologyAuthor), '"},') as ?ontologyAuthorString)
    }
  }
  
  BIND(COALESCE(?ontologyVersion1, ?ontologyVersion2, "Version IRI not available") as ?ontologyVersionIRI)
  BIND(REPLACE(?fragment, 'VersionURL', str(?ontologyVersionIRI)) as ?fragment1)
  BIND(REPLACE(?fragment1, 'working-group', str(?workinggroup)) as ?fragment2)
  BIND(REPLACE(?fragment2, 'some-org/mySpec', str(?github)) as ?fragment3)
  BIND(REPLACE(?fragment3, 'name: "Your Name"', str(?ontologyAuthors)) as ?fragment4)
  
  # Create identifiers
  bind(iri(concat(str(?textElement),'-instance')) as ?configurationElementID)
  
}""".  

condition:Classes
  a sh:PropertyShape;
  skos:prefLabel 'The user has requested the specification of ontology classes in the document.'@en;
  sh:path respec:classes;
  sh:hasValue true.

rule:Classes
  a sh:SPARQLRule;
  skos:prefLabel 'Classes rule'@en;
  rdfs:comment 'The Classes rule creates a section of classes for the ontology in the document.'@en ;
  sh:condition condition:Classes;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/>
prefix manchester: <https://data.rijksfinancien.nl/manchester/model/def/>
prefix owl: <http://www.w3.org/2002/07/owl#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix respec: <https://respec.org/model/def/>
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
prefix vann: <http://purl.org/vocab/vann/>

construct {

      ?divDefinitionClass1Instance            rdf:type html:Div;
                                              ?memberClassString ?divDefinitionClass2Instance;
                                              html:fragment ?absenceOfClassDefinitions.
      ?divDefinitionClass2Instance            rdf:type html:Section;
                                              rdf:_1 ?class_title_instance_h2;
                                              rdf:_2 ?class_IRI_p;
                                              rdf:_3 ?class_linebreak_instance1; 
                                              rdf:_4 ?class_definition_instance;
                                              rdf:_5 ?class_linebreak_instance2;  
                                              rdf:_6 ?class_linebreak_instance3;
                                              rdf:_7 ?manchester_syntax_instance.
      ?class_title_instance_h2                rdf:type html:H2;
                                              rdf:_1 ?class_dfn_instance.
      ?class_dfn_instance                     rdf:type html:Dfn;
                                              rdf:_1 ?class_title_text_instance.
      ?class_title_text_instance              rdf:type html:TextElement;
                                              html:fragment ?cleanedManchesterLabel.
      ?class_IRI_p                            rdf:type html:P;
                                              rdf:_1 ?class_IRI_strong;
                                              rdf:_2 ?class_IRI_a.
      ?class_IRI_strong                       rdf:type html:Strong;
                                              rdf:_1 ?class_IRI_text.
      ?class_IRI_text                         rdf:type html:TextElement;
                                              html:fragment 'IRI: '.
      ?class_IRI_a                            rdf:type html:A;
                                              html:href ?IRI_value_text;
                                              rdf:_1 ?IRI_value.
      ?IRI_value                              rdf:type html:TextElement;
                                              html:fragment ?IRI_value_text.
      ?class_definition_instance              rdf:type html:TextElement;
                                              html:fragment ?classDefinition.
      ?manchester_syntax_instance                   rdf:type html:Aside;
                                                      html:class "note" ;
                                                      html:title "Manchester Syntax (Extended)";
                                                      rdf:_1 ?manchester_syntax_code_instance.
      ?manchester_syntax_code_instance              rdf:type html:Code;
                                                      rdf:_1 ?manchester_table_instance.
      ?manchester_table_instance                    rdf:type html:Table;
                                                      rdf:_1 ?manchester_table_body_instance_class;
                                                      rdf:_2 ?manchester_table_body_instance_equivalence;
                                                      rdf:_3 ?manchester_table_body_instance_subclass;
                                                      rdf:_4 ?manchester_table_body_instance_seeAlso.
      ?manchester_table_body_instance_class          rdf:type html:TableBody;
                                                      rdf:_1  ?manchester_definition_tr_class;
                                                      rdf:_2  ?manchester_definition_tr_class_empty_row.
      ?manchester_definition_tr_class               rdf:type html:Row;
                                                      rdf:_1 ?manchester_definition_class_type_td;
                                                      rdf:_2 ?manchester_definition_class_value_td.
      ?manchester_definition_class_type_td          rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_definition_class_type_text. 
      ?manchester_definition_class_type_text        rdf:type html:TextElement;
                                                      html:fragment 'Class:'.
      ?manchester_definition_class_value_td         rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_definition_class_value_text.
      ?manchester_definition_class_value_text       rdf:type html:TextElement;
                                                      html:fragment ?cleanedManchesterLabel.
      ?manchester_definition_tr_class_empty_row     rdf:type html:Row;
                                                      rdf:_1 ?manchester_definition_class_empty_td1;
                                                      rdf:_2 ?manchester_definition_class_empty_td2.
      ?manchester_definition_class_empty_td1          rdf:type html:DataCell.
      ?manchester_definition_class_empty_td2          rdf:type html:DataCell.
      ?manchester_table_body_instance_equivalence   rdf:type html:TableBody;
                                                      ?memberManchesterStringEquivalentTo  ?manchester_definition_tr_equivalence.
      ?manchester_definition_tr_equivalence         rdf:type html:Row;
                                                      rdf:_1 ?manchester_definition_equivalence_type_td;
                                                      rdf:_2 ?manchester_definition_equivalence_value_td.
      ?manchester_definition_equivalence_type_td    rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_definition_equivalence_type_text. 
      ?manchester_definition_equivalence_type_text  rdf:type html:TextElement;
                                                      html:fragment 'EquivalentTo:'.
      ?manchester_definition_equivalence_value_td   rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_definition_equivalence_value_text.
      ?manchester_definition_equivalence_value_text rdf:type html:TextElement;
                                                      html:fragment ?manchesterDefinition.
      ?manchester_table_body_instance_subclass       rdf:type html:TableBody;
                                                      ?memberManchesterStringSubClassOf  ?manchester_definition_tr_subclass.
      ?manchester_definition_tr_subclass            rdf:type html:Row;
                                                      rdf:_1 ?manchester_definition_subclass_type_td;
                                                      rdf:_2 ?manchester_definition_subclass_value_td.
      ?manchester_definition_subclass_type_td       rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_definition_subclass_type_text. 
      ?manchester_definition_subclass_type_text     rdf:type html:TextElement;
                                                      html:fragment 'SubClassOf:'.
      ?manchester_definition_subclass_value_td      rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_definition_subclass_value_text.
      ?manchester_definition_subclass_value_text    rdf:type html:TextElement;
                                                      html:fragment ?manchesterDefinitionS.
      ?manchester_table_body_instance_seeAlso       rdf:type html:TableBody;
                                                      ?memberManchesterStringSeeAlso  ?manchester_definition_tr_seeAlso.
      ?manchester_definition_tr_seeAlso             rdf:type html:Row;
                                                      rdf:_1 ?manchester_definition_seeAlso_type_td;
                                                      rdf:_2 ?manchester_definition_seeAlso_value_td.
      ?manchester_definition_seeAlso_type_td        rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_definition_seeAlso_type_text. 
      ?manchester_definition_seeAlso_type_text      rdf:type html:TextElement;
                                                      html:fragment 'SeeAlso:'.
      ?manchester_definition_seeAlso_value_td       rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_definition_seeAlso_value_text.
      ?manchester_definition_seeAlso_value_text     rdf:type html:TextElement;
                                                      html:fragment ?seeAlsoLabel.
                                                    
      ?class_linebreak_instance1                          rdf:type html:Br.
      ?class_linebreak_instance2                          rdf:type html:Br.
      ?class_linebreak_instance3                          rdf:type html:Br.
      ?class_linebreak_instance5                          rdf:type html:Br.
      ?class_linebreak_instance6                          rdf:type html:Br.
}
where  {

  # Get the template

  {
    ?template rdf:type respec:ClassDefinition.
  }

  # Get the class from the ontology, the label and description, and the sequence order in which the class appears amidst other classes alphanumerically.
  {
    select ?class ?manchesterLabel ?classDefinition_original ?seeAlsoLabel ?memberClass ?manchesterDefinition ?manchesterDefinitionS ?memberManchesterEquivalentTo ?memberManchesterSubClassOf
    where {
      # Get the class ordered alphabetically on its label
      {
        select ?class ?manchesterLabel ?classDefinition_original ?seeAlsoLabel (count(?prevClass) + 1 as ?memberClass)
        where {
          ?class manchester:type 'CLASS'.
          ?class manchester:label ?manchesterLabel.
          ?class rdfs:isDefinedBy ?ontology.
          $this  dct:subject ?ontology;
                 respec:documentLanguage ?language.

          optional
          {
            ?class skos:definition ?classDefinition_original.
            filter (lang(?classDefinition_original) = ?language)
          }
          
          optional
          {
            ?class rdfs:seeAlso ?resource.
            optional {?resource manchester:label ?seeAlsoManchesterLabel.}
            BIND(COALESCE(?seeAlsoManchesterLabel, IF(isIRI(?resource), function:getPrefixedIRI(?resource), ?unboundDummy)) as ?seeAlsoLabel)
          }

          optional {
            ?prevClass manchester:type 'CLASS'.
            ?prevClass manchester:label ?prevLabel .
            filter(?prevLabel < ?manchesterLabel)
          }
        }
        group by ?class ?manchesterLabel ?classDefinition_original ?seeAlsoLabel
        order by ?manchesterLabel
      }
      optional # EquivalentTo
      {
        ?class manchester:type 'CLASS'.
        # Get the possibly multiple definitions of the class, ordered alphabetically
        {
          select ?class ?manchesterDefinition (count(?prevManchesterDefinition) + 1 as ?memberManchesterEquivalentTo)
          where {

            ?class manchester:equivalentTo ?manchesterDefinition.
            
            optional {
              ?prevClassE manchester:equivalentTo ?prevManchesterDefinition.
              filter(?prevManchesterDefinition < ?manchesterDefinition)
            }
          }
          group by ?class ?manchesterDefinition
          order by ?class ?manchesterDefinition
        }
      }
      optional # SubClassOf
      {
        ?class manchester:type 'CLASS'.
        # Get the possibly multiple definitions of the class, ordered alphabetically
        {
          select ?class ?manchesterDefinitionS (count(?prevManchesterDefinitionS) + 1 as ?memberManchesterSubClassOf)
          where {


            ?class manchester:subClassOf ?manchesterDefinitionS.

            optional {

              ?prevClassS manchester:subClassOf ?prevManchesterDefinitions.

              filter(?prevManchesterDefinitionS < ?manchesterDefinitionS)
            }
          }
          group by ?class ?manchesterDefinitionS
          order by ?class ?manchesterDefinitionS
        }
      }
    }
  }

  # If there are no classes defined by this ontology, then add text indicating this accordingly.
   
  BIND(IF(!BOUND(?class), "This ontology does not define any classes.", ?unboundDummy) as ?absenceOfClassDefinitions)
  
  # Establish order predicate
  BIND("1" as ?memberManchesterSeeAlso) # temporary solution, for now only one rdfs:seeAlso relation is expected per class.
  BIND(IRI(CONCAT(str(rdf:),"_", str(?memberClass))) as ?memberClassString) #this is the rdf:_x property that indicates the order in which the class appears
  BIND(IRI(CONCAT(str(rdf:),"_", str(?memberManchesterEquivalentTo))) as ?memberManchesterStringEquivalentTo) #this is the rdf:_x property that indicates the order in which the manchester definition appears
  BIND(IRI(CONCAT(str(rdf:),"_", str(?memberManchesterSubClassOf))) as ?memberManchesterStringSubClassOf) #this is the rdf:_x property that indicates the order in which the manchester definition appears
  BIND(IRI(CONCAT(str(rdf:),"_", str(?memberManchesterSeeAlso))) as ?memberManchesterStringSeeAlso) #this is the rdf:_x property that indicates the order in which the rdfs:seeAlso relation appears
  # Clean up text (prevent html code)
  
  BIND(function:escapeHTML(COALESCE(?classDefinition_original, "This ontology does not provide a definition for the class.")) as ?classDefinition)
  BIND(function:escapeHTML(?manchesterLabel) as ?cleanedManchesterLabel)
  
  # Establishing the IRI of the class

  BIND(STR(?class) as ?IRI_value_text)
  
  # Create identifiers - generic
  
  bind(IRI(CONCAT(STR(?template),'-instance')) as ?divDefinitionClass1Instance)
  bind(IRI(CONCAT(STR(?divDefinitionClass1Instance), '-', str(?memberClass),'-1')) as ?divDefinitionClass2Instance)
  bind(IRI(CONCAT(STR(?divDefinitionClass2Instance), '-1')) as ?class_title_instance_h2)
  bind(IRI(CONCAT(STR(?divDefinitionClass2Instance), '-2')) as ?class_IRI_p)
  bind(IRI(CONCAT(STR(?divDefinitionClass2Instance), '-3')) as ?class_linebreak_instance1)
  bind(IRI(CONCAT(STR(?divDefinitionClass2Instance), '-4')) as ?class_definition_instance)
  bind(IRI(CONCAT(STR(?divDefinitionClass2Instance), '-5')) as ?class_linebreak_instance2)
  bind(IRI(CONCAT(STR(?divDefinitionClass2Instance), '-6')) as ?class_linebreak_instance3)
  bind(IRI(CONCAT(STR(?divDefinitionClass2Instance), '-7')) as ?manchester_syntax_instance)
  bind(IRI(CONCAT(STR(?class_IRI_p), '-1')) as ?class_IRI_strong)
  bind(IRI(CONCAT(STR(?class_IRI_p), '-2')) as ?class_IRI_a)
  bind(IRI(CONCAT(STR(?class_IRI_strong), '-1')) as ?class_IRI_text)
  bind(IRI(CONCAT(STR(?class_IRI_a), '-1')) as ?IRI_value)
  bind(IRI(CONCAT(STR(?class_title_instance_h2), '-1')) as ?class_dfn_instance)
  bind(IRI(CONCAT(STR(?class_dfn_instance), '-1')) as ?class_title_text_instance)
    
  # Create identifiers - Manchester Syntax 

  bind(IRI(CONCAT(STR(?manchester_syntax_instance), '-1')) as ?manchester_syntax_code_instance)
  bind(IRI(CONCAT(STR(?manchester_syntax_code_instance), '-1')) as ?manchester_table_instance)

  bind(IRI(CONCAT(STR(?manchester_table_instance), '-1')) as ?manchester_table_body_instance_class)
  bind(IF(BOUND(?manchesterDefinition), IRI(CONCAT(STR(?manchester_table_instance), '-2')), ?unboundDummy) as ?manchester_table_body_instance_equivalence)
  bind(IF(BOUND(?manchesterDefinitionS), IRI(CONCAT(STR(?manchester_table_instance), '-3')), ?unboundDummy) as ?manchester_table_body_instance_subclass)
  bind(IF(BOUND(?seeAlsoLabel), IRI(CONCAT(STR(?manchester_table_instance), '-4')), ?unboundDummy) as ?manchester_table_body_instance_seeAlso)

  bind(IRI(CONCAT(STR(?manchester_table_body_instance_class), '-1')) as ?manchester_definition_tr_class)
  bind(IRI(CONCAT(STR(?manchester_table_body_instance_class), '-2')) as ?manchester_definition_tr_class_empty_row)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_class), '-1')) as ?manchester_definition_class_type_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_class), '-2')) as ?manchester_definition_class_value_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_class_empty_row), '-1')) as ?manchester_definition_class_empty_td1)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_class_empty_row), '-2')) as ?manchester_definition_class_empty_td2)
  bind(IRI(CONCAT(STR(?manchester_definition_class_type_td), '-1')) as ?manchester_definition_class_type_text)
  bind(IRI(CONCAT(STR(?manchester_definition_class_value_td), '-1')) as ?manchester_definition_class_value_text)

  bind(IRI(CONCAT(STR(?manchester_table_body_instance_equivalence), '-', str(?memberManchesterEquivalentTo))) as ?manchester_definition_tr_equivalence)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_equivalence), '-1')) as ?manchester_definition_equivalence_type_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_equivalence), '-2')) as ?manchester_definition_equivalence_value_td)
  bind(IRI(CONCAT(STR(?manchester_definition_equivalence_type_td), '-1')) as ?manchester_definition_equivalence_type_text)
  bind(IRI(CONCAT(STR(?manchester_definition_equivalence_value_td) , '-1')) as ?manchester_definition_equivalence_value_text)

  bind(IRI(CONCAT(STR(?manchester_table_body_instance_subclass) , '-', str(?memberManchesterSubClassOf))) as ?manchester_definition_tr_subclass)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_subclass) , '-1')) as ?manchester_definition_subclass_type_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_subclass) , '-2')) as ?manchester_definition_subclass_value_td)
  bind(IRI(CONCAT(STR(?manchester_definition_subclass_type_td) , '-1')) as ?manchester_definition_subclass_type_text)
  bind(IRI(CONCAT(STR(?manchester_definition_subclass_value_td) , '-1')) as ?manchester_definition_subclass_value_text)

  bind(IRI(CONCAT(STR(?manchester_table_body_instance_seeAlso) , '-',str(?memberManchesterSeeAlso))) as ?manchester_definition_tr_seeAlso)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_seeAlso), '-1')) as ?manchester_definition_seeAlso_type_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_seeAlso), '-2')) as ?manchester_definition_seeAlso_value_td)
  bind(IRI(CONCAT(STR(?manchester_definition_seeAlso_type_td), '-1')) as ?manchester_definition_seeAlso_type_text)
  bind(IRI(CONCAT(STR(?manchester_definition_seeAlso_value_td), '-1')) as ?manchester_definition_seeAlso_value_text)
  
}

""".

condition:ObjectProperties
  a sh:PropertyShape;
  skos:prefLabel 'The user has requested the specification of ontology object properties in the document.'@en;
  sh:path respec:objectProperties;
  sh:hasValue true.

rule:ObjectProperties
  a sh:SPARQLRule;
  skos:prefLabel 'Object properties rule'@en;
  rdfs:comment 'The object properties rule creates a section of object properties for the ontology in the document.'@en ;
  sh:condition condition:ObjectProperties;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/>
prefix manchester: <https://data.rijksfinancien.nl/manchester/model/def/>
prefix owl: <http://www.w3.org/2002/07/owl#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix respec: <https://respec.org/model/def/>
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
prefix vann: <http://purl.org/vocab/vann/>

construct {

      ?divDefinitionObjectProperty1Instance                   rdf:type html:Div;
                                                              ?rdf_member ?divDefinitionObjectProperty2Instance;
                                                              html:fragment ?absenceOfObjectPropertyDefinitions.
      ?divDefinitionObjectProperty2Instance                   rdf:type html:Section;
                                                              rdf:_1 ?objectproperty_title_instance_h2;
                                                              rdf:_2 ?objectproperty_IRI_p;
                                                              rdf:_3 ?objectproperty_linebreak_instance1; 
                                                              rdf:_4 ?objectproperty_definition_instance;
                                                              rdf:_5 ?objectproperty_linebreak_instance2;  
                                                              rdf:_6 ?objectproperty_linebreak_instance3;
                                                              rdf:_7 ?manchester_syntax_instance.
      ?objectproperty_title_instance_h2                       rdf:type html:H2;
                                                              rdf:_1 ?objectproperty_dfn_instance.
      ?objectproperty_dfn_instance                            rdf:type html:Dfn;
                                                              rdf:_1 ?objectproperty_title_text_instance.
      ?objectproperty_title_text_instance                     rdf:type html:TextElement;
                                                              html:fragment ?objectPropertyManchesterLabel.
      ?objectproperty_IRI_p                                   rdf:type html:P;
                                                              rdf:_1 ?objectproperty_IRI_strong;
                                                              rdf:_2 ?objectproperty_IRI_a.
      ?objectproperty_IRI_strong                              rdf:type html:Strong;
                                                              rdf:_1 ?objectproperty_IRI_text.
      ?objectproperty_IRI_text                                rdf:type html:TextElement;
                                                              html:fragment 'IRI: '.
      ?objectproperty_IRI_a                                   rdf:type html:A;
                                                              html:href ?fullIRI;
                                                              rdf:_1 ?IRI_value.
      ?IRI_value                                              rdf:type html:TextElement;
                                                              html:fragment ?fullIRI.
      ?objectproperty_definition_instance                     rdf:type html:TextElement;
                                                              html:fragment ?objectPropertyDefinition_text.
      ?manchester_syntax_instance                             rdf:type html:Aside;
                                                              html:class "note" ;
                                                              html:title "Manchester Syntax (Extended)";
                                                              rdf:_1 ?manchester_syntax_code_instance.
      ?manchester_syntax_code_instance                        rdf:type html:Code;
                                                              rdf:_1 ?manchester_table_instance.
      ?manchester_table_instance                              rdf:type html:Table;
                                                              rdf:_1 ?manchester_table_body_instance_objectproperty.
      ?manchester_table_body_instance_objectproperty          rdf:type html:TableBody;
                                                              rdf:_1 ?manchester_definition_tr_objectproperty;
                                                              rdf:_2 ?manchester_definition_tr_objectproperty_empty_row;
                                                              rdf:_3 ?manchester_domain_tr_objectproperty;
                                                              rdf:_4 ?manchester_range_tr_objectproperty;
                                                              rdf:_5 ?manchester_subproperty_tr_objectproperty.
      ?manchester_definition_tr_objectproperty                rdf:type html:Row;
                                                              rdf:_1 ?manchester_definition_objectproperty_type_td;
                                                              rdf:_2 ?manchester_definition_objectproperty_value_td.
      ?manchester_definition_objectproperty_type_td           rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_definition_objectproperty_type_text. 
      ?manchester_definition_objectproperty_type_text         rdf:type html:TextElement;
                                                              html:fragment 'ObjectProperty:'.
      ?manchester_definition_objectproperty_value_td          rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_definition_objectproperty_value_text.
      ?manchester_definition_objectproperty_value_text        rdf:type html:TextElement;
                                                              html:fragment ?objectPropertyManchesterLabel.

      ?manchester_definition_tr_objectproperty_empty_row      rdf:type html:Row;
                                                              rdf:_1 ?manchester_definition_objectproperty_empty_td1;
                                                              rdf:_2 ?manchester_definition_objectproperty_empty_td2.
      ?manchester_definition_objectproperty_empty_td1         rdf:type html:DataCell.
      ?manchester_definition_objectproperty_empty_td2         rdf:type html:DataCell.

      ?manchester_domain_tr_objectproperty                    rdf:type html:Row;
                                                              rdf:_1 ?manchester_domain_tr_objectproperty_type_td;
                                                              rdf:_2 ?manchester_domain_tr_objectproperty_value_td.
      ?manchester_domain_tr_objectproperty_type_td            rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_domain_tr_objectproperty_type_text. 
      ?manchester_domain_tr_objectproperty_type_text          rdf:type html:TextElement;
                                                              html:fragment 'Domain:'.
      ?manchester_domain_tr_objectproperty_value_td           rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_domain_tr_objectproperty_value_text.
      ?manchester_domain_tr_objectproperty_value_text         rdf:type html:TextElement;
                                                              html:fragment ?objectPropertyManchesterDomain.

      ?manchester_range_tr_objectproperty                    rdf:type html:Row;
                                                             rdf:_1 ?manchester_range_tr_objectproperty_type_td;
                                                             rdf:_2 ?manchester_range_tr_objectproperty_value_td.
      ?manchester_range_tr_objectproperty_type_td            rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_range_tr_objectproperty_type_text. 
      ?manchester_range_tr_objectproperty_type_text          rdf:type html:TextElement;
                                                             html:fragment 'Range:'.
      ?manchester_range_tr_objectproperty_value_td           rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_range_tr_objectproperty_value_text.
      ?manchester_range_tr_objectproperty_value_text         rdf:type html:TextElement;
                                                             html:fragment ?objectPropertyManchesterRange.

      ?manchester_subproperty_tr_objectproperty              rdf:type html:Row;
                                                             rdf:_1 ?manchester_subproperty_tr_objectproperty_type_td;
                                                             rdf:_2 ?manchester_subproperty_tr_objectproperty_value_td.
      ?manchester_subproperty_tr_objectproperty_type_td      rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_subproperty_tr_objectproperty_type_text. 
      ?manchester_subproperty_tr_objectproperty_type_text    rdf:type html:TextElement;
                                                             html:fragment 'Subproperty:'.
      ?manchester_subproperty_tr_objectproperty_value_td     rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_subproperty_tr_objectproperty_value_text.
      ?manchester_subproperty_tr_objectproperty_value_text   rdf:type html:TextElement;
                                                             html:fragment ?objectPropertyManchesterSubPropertyOf.

      ?objectproperty_linebreak_instance1                          rdf:type html:Br.
      ?objectproperty_linebreak_instance2                          rdf:type html:Br.
      ?objectproperty_linebreak_instance3                          rdf:type html:Br.
      ?objectproperty_linebreak_instance5                          rdf:type html:Br.
      ?objectproperty_linebreak_instance6                          rdf:type html:Br.
}
where  {

  # Get the template

  {?template rdf:type respec:ObjectProperty.}

  # Get the sorted entities from the ontology including semantics
  
  {SELECT ?objectProperty ?objectPropertyManchesterLabel_original ?objectPropertyManchesterLabel ?objectPropertyManchesterDomain ?objectPropertyManchesterRange ?objectPropertyManchesterSubPropertyOf ?objectPropertyDefinition_text (COUNT(?prevObjectProperty) + 1 AS ?member)
WHERE {
  ?objectProperty a owl:ObjectProperty .
  ?objectProperty manchester:label ?objectPropertyManchesterLabel_original .
  ?objectProperty rdfs:isDefinedBy ?ontology.
  $this dct:subject ?ontology;
        respec:documentLanguage ?language.

  OPTIONAL{
  ?objectProperty skos:definition ?objectPropertyDefinition_original.
  FILTER (LANG(?objectPropertyDefinition_original) = ?language)
  } 
  OPTIONAL{
  ?objectProperty manchester:domain ?objectPropertyManchesterDomain.}
  OPTIONAL{
  ?objectProperty manchester:range ?objectPropertyManchesterRange.}
  OPTIONAL{
  ?objectProperty manchester:subPropertyOf ?objectPropertyManchesterSubPropertyOf.}
  
  BIND(function:escapeHTML(?objectPropertyManchesterLabel_original) as ?objectPropertyManchesterLabel)
  BIND(IF(BOUND(?objectPropertyDefinition_original), function:escapeHTML(?objectPropertyDefinition_original), "No definition provided by this ontology.") as ?objectPropertyDefinition_text)
   
  OPTIONAL {
    ?prevObjectProperty a owl:ObjectProperty .
    ?prevObjectProperty manchester:label ?prevLabel .
    FILTER(?prevLabel < ?objectPropertyManchesterLabel_original)
  }
}
  GROUP BY ?objectPropertyManchesterLabel_original ?objectPropertyManchesterLabel ?objectProperty ?objectPropertyManchesterDomain ?objectPropertyManchesterRange ?objectPropertyManchesterSubPropertyOf ?objectPropertyDefinition_text 
  ORDER BY ?objectPropertyManchesterLabel_original
}

  BIND(IRI(CONCAT(str(rdf:),"_", str(?member))) as ?rdf_member)  
  BIND(IF(!BOUND(?objectProperty), "This ontology does not define any object properties.", ?unboundDummy) as ?absenceOfObjectPropertyDefinitions)

  # Establishing the full IRI of the object property.
  
  BIND(STR(?objectProperty) as ?fullIRI)
  
  # Create identifiers - generic
  
  bind(IRI(CONCAT(STR(?template),'-instance')) as ?divDefinitionObjectProperty1Instance)
  bind(IRI(CONCAT(STR(?divDefinitionObjectProperty1Instance), '-', str(?member),'-1')) as ?divDefinitionObjectProperty2Instance)
  bind(IRI(CONCAT(STR(?divDefinitionObjectProperty2Instance), '-1')) as ?objectproperty_title_instance_h2)
  bind(IRI(CONCAT(STR(?divDefinitionObjectProperty2Instance), '-2')) as ?objectproperty_IRI_p)
  bind(IRI(CONCAT(STR(?divDefinitionObjectProperty2Instance), '-3')) as ?objectproperty_linebreak_instance1)
  bind(IRI(CONCAT(STR(?divDefinitionObjectProperty2Instance), '-4')) as ?objectproperty_definition_instance)
  bind(IRI(CONCAT(STR(?divDefinitionObjectProperty2Instance), '-5')) as ?objectproperty_linebreak_instance2)
  bind(IRI(CONCAT(STR(?divDefinitionObjectProperty2Instance), '-6')) as ?objectproperty_linebreak_instance3)
  bind(IRI(CONCAT(STR(?divDefinitionObjectProperty2Instance), '-7')) as ?manchester_syntax_instance)
  bind(IRI(CONCAT(STR(?objectproperty_IRI_p), '-1')) as ?objectproperty_IRI_strong)
  bind(IRI(CONCAT(STR(?objectproperty_IRI_p), '-2')) as ?objectproperty_IRI_a)
  bind(IRI(CONCAT(STR(?objectproperty_IRI_strong), '-1')) as ?objectproperty_IRI_text)
  bind(IRI(CONCAT(STR(?objectproperty_IRI_a), '-1')) as ?IRI_value)
  bind(IRI(CONCAT(STR(?objectproperty_title_instance_h2), '-1')) as ?objectproperty_dfn_instance)
  bind(IRI(CONCAT(STR(?objectproperty_dfn_instance), '-1')) as ?objectproperty_title_text_instance)
    
  # Create identifiers - Manchester Syntax 

  bind(IRI(CONCAT(STR(?manchester_syntax_instance), '-1')) as ?manchester_syntax_code_instance)
  bind(IRI(CONCAT(STR(?manchester_syntax_code_instance), '-1')) as ?manchester_table_instance)
  bind(IRI(CONCAT(STR(?manchester_table_instance), '-1')) as ?manchester_table_body_instance_objectproperty)

  bind(IRI(CONCAT(STR(?manchester_table_body_instance_objectproperty), '-1')) as ?manchester_definition_tr_objectproperty)
  bind(IRI(CONCAT(STR(?manchester_table_body_instance_objectproperty), '-2')) as ?manchester_definition_tr_objectproperty_empty_row)
  bind(IF(BOUND(?objectPropertyManchesterDomain),IRI(CONCAT(STR(?manchester_table_body_instance_objectproperty), '-3')), ?unboundDummy) as ?manchester_domain_tr_objectproperty )
  bind(IF(BOUND(?objectPropertyManchesterRange),IRI(CONCAT(STR(?manchester_table_body_instance_objectproperty), '-4')), ?unboundDummy) as ?manchester_range_tr_objectproperty )
  bind(IF(BOUND(?objectPropertyManchesterSubPropertyOf),IRI(CONCAT(STR(?manchester_table_body_instance_objectproperty), '-5')),?unboundDummy) as ?manchester_subproperty_tr_objectproperty )
  
  bind(IRI(CONCAT(STR(?manchester_definition_tr_objectproperty), '-1')) as ?manchester_definition_objectproperty_type_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_objectproperty), '-2')) as ?manchester_definition_objectproperty_value_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_objectproperty_empty_row), '-1')) as ?manchester_definition_objectproperty_empty_td1)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_objectproperty_empty_row), '-2')) as ?manchester_definition_objectproperty_empty_td2)
  bind(IRI(CONCAT(STR(?manchester_definition_objectproperty_type_td), '-1')) as ?manchester_definition_objectproperty_type_text)
  bind(IRI(CONCAT(STR(?manchester_definition_objectproperty_value_td), '-1')) as ?manchester_definition_objectproperty_value_text)
  
  bind(IRI(CONCAT(STR(?manchester_domain_tr_objectproperty), '-1')) as ?manchester_domain_tr_objectproperty_type_td)
  bind(IRI(CONCAT(STR(?manchester_domain_tr_objectproperty), '-2')) as ?manchester_domain_tr_objectproperty_value_td)
  bind(IRI(CONCAT(STR(?manchester_domain_tr_objectproperty_type_td), '-1')) as ?manchester_domain_tr_objectproperty_type_text)
  bind(IRI(CONCAT(STR(?manchester_domain_tr_objectproperty_value_td), '-1')) as ?manchester_domain_tr_objectproperty_value_text)

  bind(IRI(CONCAT(STR(?manchester_range_tr_objectproperty), '-1')) as ?manchester_range_tr_objectproperty_type_td)
  bind(IRI(CONCAT(STR(?manchester_range_tr_objectproperty), '-2')) as ?manchester_range_tr_objectproperty_value_td)
  bind(IRI(CONCAT(STR(?manchester_range_tr_objectproperty_type_td), '-1')) as ?manchester_range_tr_objectproperty_type_text)
  bind(IRI(CONCAT(STR(?manchester_range_tr_objectproperty_value_td), '-1')) as ?manchester_range_tr_objectproperty_value_text)
  
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_objectproperty), '-1')) as ?manchester_subproperty_tr_objectproperty_type_td)
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_objectproperty), '-2')) as ?manchester_subproperty_tr_objectproperty_value_td)
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_objectproperty_type_td), '-1')) as ?manchester_subproperty_tr_objectproperty_type_text)
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_objectproperty_value_td), '-1')) as ?manchester_subproperty_tr_objectproperty_value_text)

}
""".

condition:DatatypeProperties
  a sh:PropertyShape;
  skos:prefLabel 'The user has requested the specification of ontology datatype properties in the document.'@en;
  sh:path respec:datatypeProperties;
  sh:hasValue true.

rule:DatatypeProperties
  a sh:SPARQLRule;
  skos:prefLabel 'Datatype properties rule'@en;
  rdfs:comment 'The datatype properties rule creates a section of datatype properties for the ontology in the document.'@en ;
  sh:condition condition:DatatypeProperties;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/>
prefix manchester: <https://data.rijksfinancien.nl/manchester/model/def/>
prefix owl: <http://www.w3.org/2002/07/owl#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix respec: <https://respec.org/model/def/>
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
prefix vann: <http://purl.org/vocab/vann/>

construct {

      ?divDefinitionDatatypeProperty1Instance                   rdf:type html:Div;
                                                              ?rdf_member ?divDefinitionDatatypeProperty2Instance;
                                                              html:fragment ?absenceOfDatatypePropertyDefinitions.
      ?divDefinitionDatatypeProperty2Instance                   rdf:type html:Section;
                                                              rdf:_1 ?datatypeproperty_title_instance_h2;
                                                              rdf:_2 ?datatypeproperty_IRI_p;
                                                              rdf:_3 ?datatypeproperty_linebreak_instance1; 
                                                              rdf:_4 ?datatypeproperty_definition_instance;
                                                              rdf:_5 ?datatypeproperty_linebreak_instance2;  
                                                              rdf:_6 ?datatypeproperty_linebreak_instance3;
                                                              rdf:_7 ?manchester_syntax_instance.
      ?datatypeproperty_title_instance_h2                       rdf:type html:H2;
                                                              rdf:_1 ?datatypeproperty_dfn_instance.
      ?datatypeproperty_dfn_instance                            rdf:type html:Dfn;
                                                              rdf:_1 ?datatypeproperty_title_text_instance.
      ?datatypeproperty_title_text_instance                     rdf:type html:TextElement;
                                                              html:fragment ?datatypePropertyManchesterLabel.
      ?datatypeproperty_IRI_p                                   rdf:type html:P;
                                                              rdf:_1 ?datatypeproperty_IRI_strong;
                                                              rdf:_2 ?datatypeproperty_IRI_a.
      ?datatypeproperty_IRI_strong                              rdf:type html:Strong;
                                                              rdf:_1 ?datatypeproperty_IRI_text.
      ?datatypeproperty_IRI_text                                rdf:type html:TextElement;
                                                              html:fragment 'IRI: '.
      ?datatypeproperty_IRI_a                                   rdf:type html:A;
                                                              html:href ?fullIRI;
                                                              rdf:_1 ?IRI_value.
      ?IRI_value                                              rdf:type html:TextElement;
                                                              html:fragment ?fullIRI.
      ?datatypeproperty_definition_instance                     rdf:type html:TextElement;
                                                              html:fragment ?datatypePropertyDefinition_text.
      ?manchester_syntax_instance                             rdf:type html:Aside;
                                                              html:class "note" ;
                                                              html:title "Manchester Syntax (Extended)";
                                                              rdf:_1 ?manchester_syntax_code_instance.
      ?manchester_syntax_code_instance                        rdf:type html:Code;
                                                              rdf:_1 ?manchester_table_instance.
      ?manchester_table_instance                              rdf:type html:Table;
                                                              rdf:_1 ?manchester_table_body_instance_datatypeproperty.
      ?manchester_table_body_instance_datatypeproperty          rdf:type html:TableBody;
                                                              rdf:_1 ?manchester_definition_tr_datatypeproperty;
                                                              rdf:_2 ?manchester_definition_tr_datatypeproperty_empty_row;
                                                              rdf:_3 ?manchester_domain_tr_datatypeproperty;
                                                              rdf:_4 ?manchester_range_tr_datatypeproperty;
                                                              rdf:_5 ?manchester_subproperty_tr_datatypeproperty.
      ?manchester_definition_tr_datatypeproperty                rdf:type html:Row;
                                                              rdf:_1 ?manchester_definition_datatypeproperty_type_td;
                                                              rdf:_2 ?manchester_definition_datatypeproperty_value_td.
      ?manchester_definition_datatypeproperty_type_td           rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_definition_datatypeproperty_type_text. 
      ?manchester_definition_datatypeproperty_type_text         rdf:type html:TextElement;
                                                              html:fragment 'DatatypeProperty:'.
      ?manchester_definition_datatypeproperty_value_td          rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_definition_datatypeproperty_value_text.
      ?manchester_definition_datatypeproperty_value_text        rdf:type html:TextElement;
                                                              html:fragment ?datatypePropertyManchesterLabel.

      ?manchester_definition_tr_datatypeproperty_empty_row      rdf:type html:Row;
                                                              rdf:_1 ?manchester_definition_datatypeproperty_empty_td1;
                                                              rdf:_2 ?manchester_definition_datatypeproperty_empty_td2.
      ?manchester_definition_datatypeproperty_empty_td1         rdf:type html:DataCell.
      ?manchester_definition_datatypeproperty_empty_td2         rdf:type html:DataCell.

      ?manchester_domain_tr_datatypeproperty                    rdf:type html:Row;
                                                              rdf:_1 ?manchester_domain_tr_datatypeproperty_type_td;
                                                              rdf:_2 ?manchester_domain_tr_datatypeproperty_value_td.
      ?manchester_domain_tr_datatypeproperty_type_td            rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_domain_tr_datatypeproperty_type_text. 
      ?manchester_domain_tr_datatypeproperty_type_text          rdf:type html:TextElement;
                                                              html:fragment 'Domain:'.
      ?manchester_domain_tr_datatypeproperty_value_td           rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_domain_tr_datatypeproperty_value_text.
      ?manchester_domain_tr_datatypeproperty_value_text         rdf:type html:TextElement;
                                                              html:fragment ?datatypePropertyManchesterDomain.

      ?manchester_range_tr_datatypeproperty                    rdf:type html:Row;
                                                             rdf:_1 ?manchester_range_tr_datatypeproperty_type_td;
                                                             rdf:_2 ?manchester_range_tr_datatypeproperty_value_td.
      ?manchester_range_tr_datatypeproperty_type_td            rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_range_tr_datatypeproperty_type_text. 
      ?manchester_range_tr_datatypeproperty_type_text          rdf:type html:TextElement;
                                                             html:fragment 'Range:'.
      ?manchester_range_tr_datatypeproperty_value_td           rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_range_tr_datatypeproperty_value_text.
      ?manchester_range_tr_datatypeproperty_value_text         rdf:type html:TextElement;
                                                             html:fragment ?datatypePropertyManchesterRange.

      ?manchester_subproperty_tr_datatypeproperty              rdf:type html:Row;
                                                             rdf:_1 ?manchester_subproperty_tr_datatypeproperty_type_td;
                                                             rdf:_2 ?manchester_subproperty_tr_datatypeproperty_value_td.
      ?manchester_subproperty_tr_datatypeproperty_type_td      rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_subproperty_tr_datatypeproperty_type_text. 
      ?manchester_subproperty_tr_datatypeproperty_type_text    rdf:type html:TextElement;
                                                             html:fragment 'Subproperty:'.
      ?manchester_subproperty_tr_datatypeproperty_value_td     rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_subproperty_tr_datatypeproperty_value_text.
      ?manchester_subproperty_tr_datatypeproperty_value_text   rdf:type html:TextElement;
                                                             html:fragment ?datatypePropertyManchesterSubPropertyOf.

      ?datatypeproperty_linebreak_instance1                          rdf:type html:Br.
      ?datatypeproperty_linebreak_instance2                          rdf:type html:Br.
      ?datatypeproperty_linebreak_instance3                          rdf:type html:Br.
      ?datatypeproperty_linebreak_instance5                          rdf:type html:Br.
      ?datatypeproperty_linebreak_instance6                          rdf:type html:Br.
}
where  {

  # Get the template

  {?template rdf:type respec:DatatypeProperty.}

  # Get the sorted entities from the ontology including semantics
  
  {SELECT ?datatypeProperty ?datatypePropertyManchesterLabel_original ?datatypePropertyManchesterLabel ?datatypePropertyManchesterDomain ?datatypePropertyManchesterRange ?datatypePropertyManchesterSubPropertyOf ?datatypePropertyDefinition_text (COUNT(?prevDatatypeProperty) + 1 AS ?member)
WHERE {
  ?datatypeProperty a owl:DatatypeProperty .
  ?datatypeProperty manchester:label ?datatypePropertyManchesterLabel_original .
  ?datatypeProperty rdfs:isDefinedBy ?ontology.
  $this dct:subject ?ontology;
        respec:documentLanguage ?language.

  OPTIONAL{
  ?datatypeProperty skos:definition ?datatypePropertyDefinition_original.
  FILTER (LANG(?datatypePropertyDefinition_original) = ?language)
  }
  OPTIONAL{
  ?datatypeProperty manchester:domain ?datatypePropertyManchesterDomain.}
  OPTIONAL{
  ?datatypeProperty manchester:range ?datatypePropertyManchesterRange.}
  OPTIONAL{
  ?datatypeProperty manchester:subPropertyOf ?datatypePropertyManchesterSubPropertyOf.}
  
  BIND(function:escapeHTML(?datatypePropertyManchesterLabel_original) as ?datatypePropertyManchesterLabel)
  BIND(IF(BOUND(?datatypePropertyDefinition_original), COALESCE(function:escapeHTML(?datatypePropertyDefinition_original)), "No definition provided by this ontology.") as ?datatypePropertyDefinition_text)

  
  OPTIONAL {
    ?prevDatatypeProperty a owl:DatatypeProperty .
    ?prevDatatypeProperty manchester:label ?prevLabel .
    FILTER(?prevLabel < ?datatypePropertyManchesterLabel_original)
  }
}
  GROUP BY ?datatypePropertyManchesterLabel_original ?datatypePropertyManchesterLabel ?datatypeProperty ?datatypePropertyManchesterDomain ?datatypePropertyManchesterRange ?datatypePropertyManchesterSubPropertyOf ?datatypePropertyDefinition_text 
  ORDER BY ?datatypePropertyManchesterLabel_original
}
  BIND(IRI(CONCAT(str(rdf:),"_", str(?member))) as ?rdf_member)  
  BIND(IF(!BOUND(?datatypeProperty), "This ontology does not define any datatype properties.", ?unboundDummy) as ?absenceOfDataTypePropertyDefinitions)

  # Establishing the full IRI of the datatype property.
  
  BIND(STR(?datatypeProperty) as ?fullIRI)
  
  # Create identifiers - generic
  
  bind(IRI(CONCAT(STR(?template),'-instance')) as ?divDefinitionDatatypeProperty1Instance)
  bind(IRI(CONCAT(STR(?divDefinitionDatatypeProperty1Instance), '-', str(?member),'-1')) as ?divDefinitionDatatypeProperty2Instance)
  bind(IRI(CONCAT(STR(?divDefinitionDatatypeProperty2Instance), '-1')) as ?datatypeproperty_title_instance_h2)
  bind(IRI(CONCAT(STR(?divDefinitionDatatypeProperty2Instance), '-2')) as ?datatypeproperty_IRI_p)
  bind(IRI(CONCAT(STR(?divDefinitionDatatypeProperty2Instance), '-3')) as ?datatypeproperty_linebreak_instance1)
  bind(IRI(CONCAT(STR(?divDefinitionDatatypeProperty2Instance), '-4')) as ?datatypeproperty_definition_instance)
  bind(IRI(CONCAT(STR(?divDefinitionDatatypeProperty2Instance), '-5')) as ?datatypeproperty_linebreak_instance2)
  bind(IRI(CONCAT(STR(?divDefinitionDatatypeProperty2Instance), '-6')) as ?datatypeproperty_linebreak_instance3)
  bind(IRI(CONCAT(STR(?divDefinitionDatatypeProperty2Instance), '-7')) as ?manchester_syntax_instance)
  bind(IRI(CONCAT(STR(?datatypeproperty_IRI_p), '-1')) as ?datatypeproperty_IRI_strong)
  bind(IRI(CONCAT(STR(?datatypeproperty_IRI_p), '-2')) as ?datatypeproperty_IRI_a)
  bind(IRI(CONCAT(STR(?datatypeproperty_IRI_strong), '-1')) as ?datatypeproperty_IRI_text)
  bind(IRI(CONCAT(STR(?datatypeproperty_IRI_a), '-1')) as ?IRI_value)
  bind(IRI(CONCAT(STR(?datatypeproperty_title_instance_h2), '-1')) as ?datatypeproperty_dfn_instance)
  bind(IRI(CONCAT(STR(?datatypeproperty_dfn_instance), '-1')) as ?datatypeproperty_title_text_instance)
    
  # Create identifiers - Manchester Syntax 

  bind(IRI(CONCAT(STR(?manchester_syntax_instance), '-1')) as ?manchester_syntax_code_instance)
  bind(IRI(CONCAT(STR(?manchester_syntax_code_instance), '-1')) as ?manchester_table_instance)
  bind(IRI(CONCAT(STR(?manchester_table_instance), '-1')) as ?manchester_table_body_instance_datatypeproperty)

  bind(IRI(CONCAT(STR(?manchester_table_body_instance_datatypeproperty), '-1')) as ?manchester_definition_tr_datatypeproperty)
  bind(IRI(CONCAT(STR(?manchester_table_body_instance_datatypeproperty), '-2')) as ?manchester_definition_tr_datatypeproperty_empty_row)
  bind(IF(BOUND(?datatypePropertyManchesterDomain),IRI(CONCAT(STR(?manchester_table_body_instance_datatypeproperty), '-3')), ?unboundDummy) as ?manchester_domain_tr_datatypeproperty )
  bind(IF(BOUND(?datatypePropertyManchesterRange),IRI(CONCAT(STR(?manchester_table_body_instance_datatypeproperty), '-4')), ?unboundDummy) as ?manchester_range_tr_datatypeproperty )
  bind(IF(BOUND(?datatypePropertyManchesterSubPropertyOf),IRI(CONCAT(STR(?manchester_table_body_instance_datatypeproperty), '-5')),?unboundDummy) as ?manchester_subproperty_tr_datatypeproperty )
  
  bind(IRI(CONCAT(STR(?manchester_definition_tr_datatypeproperty), '-1')) as ?manchester_definition_datatypeproperty_type_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_datatypeproperty), '-2')) as ?manchester_definition_datatypeproperty_value_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_datatypeproperty_empty_row), '-1')) as ?manchester_definition_datatypeproperty_empty_td1)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_datatypeproperty_empty_row), '-2')) as ?manchester_definition_datatypeproperty_empty_td2)
  bind(IRI(CONCAT(STR(?manchester_definition_datatypeproperty_type_td), '-1')) as ?manchester_definition_datatypeproperty_type_text)
  bind(IRI(CONCAT(STR(?manchester_definition_datatypeproperty_value_td), '-1')) as ?manchester_definition_datatypeproperty_value_text)
  
  bind(IRI(CONCAT(STR(?manchester_domain_tr_datatypeproperty), '-1')) as ?manchester_domain_tr_datatypeproperty_type_td)
  bind(IRI(CONCAT(STR(?manchester_domain_tr_datatypeproperty), '-2')) as ?manchester_domain_tr_datatypeproperty_value_td)
  bind(IRI(CONCAT(STR(?manchester_domain_tr_datatypeproperty_type_td), '-1')) as ?manchester_domain_tr_datatypeproperty_type_text)
  bind(IRI(CONCAT(STR(?manchester_domain_tr_datatypeproperty_value_td), '-1')) as ?manchester_domain_tr_datatypeproperty_value_text)

  bind(IRI(CONCAT(STR(?manchester_range_tr_datatypeproperty), '-1')) as ?manchester_range_tr_datatypeproperty_type_td)
  bind(IRI(CONCAT(STR(?manchester_range_tr_datatypeproperty), '-2')) as ?manchester_range_tr_datatypeproperty_value_td)
  bind(IRI(CONCAT(STR(?manchester_range_tr_datatypeproperty_type_td), '-1')) as ?manchester_range_tr_datatypeproperty_type_text)
  bind(IRI(CONCAT(STR(?manchester_range_tr_datatypeproperty_value_td), '-1')) as ?manchester_range_tr_datatypeproperty_value_text)
  
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_datatypeproperty), '-1')) as ?manchester_subproperty_tr_datatypeproperty_type_td)
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_datatypeproperty), '-2')) as ?manchester_subproperty_tr_datatypeproperty_value_td)
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_datatypeproperty_type_td), '-1')) as ?manchester_subproperty_tr_datatypeproperty_type_text)
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_datatypeproperty_value_td), '-1')) as ?manchester_subproperty_tr_datatypeproperty_value_text)

}
""".

condition:RDF_Properties
  a sh:PropertyShape;
  skos:prefLabel 'The user has requested the specification of ontology RDF properties in the document.'@en;
  sh:path respec:rdfProperties;
  sh:hasValue true.

rule:RDF_Properties
  a sh:SPARQLRule;
  skos:prefLabel 'RDF properties rule'@en;
  rdfs:comment 'The RDF properties rule creates a section of RDF properties for the ontology in the document.'@en ;
  sh:condition condition:RDF_Properties;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/>
prefix manchester: <https://data.rijksfinancien.nl/manchester/model/def/>
prefix owl: <http://www.w3.org/2002/07/owl#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix respec: <https://respec.org/model/def/>
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
prefix vann: <http://purl.org/vocab/vann/>

construct {

      ?divDefinitionRDF_Property1Instance                   rdf:type html:Div;
                                                              ?rdf_member ?divDefinitionRDF_Property2Instance;
                                                              html:fragment ?absenceOfRDF_PropertyDefinitions.
      ?divDefinitionRDF_Property2Instance                   rdf:type html:Section;
                                                              rdf:_1 ?RDF_Property_title_instance_h2;
                                                              rdf:_2 ?RDF_Property_IRI_p;
                                                              rdf:_3 ?RDF_Property_linebreak_instance1; 
                                                              rdf:_4 ?RDF_Property_definition_instance;
                                                              rdf:_5 ?RDF_Property_linebreak_instance2;  
                                                              rdf:_6 ?RDF_Property_linebreak_instance3;
                                                              rdf:_7 ?manchester_syntax_instance.
      ?RDF_Property_title_instance_h2                       rdf:type html:H2;
                                                              rdf:_1 ?RDF_Property_dfn_instance.
      ?RDF_Property_dfn_instance                            rdf:type html:Dfn;
                                                              rdf:_1 ?RDF_Property_title_text_instance.
      ?RDF_Property_title_text_instance                     rdf:type html:TextElement;
                                                              html:fragment ?RDF_PropertyManchesterLabel.
      ?RDF_Property_IRI_p                                   rdf:type html:P;
                                                              rdf:_1 ?RDF_Property_IRI_strong;
                                                              rdf:_2 ?RDF_Property_IRI_a.
      ?RDF_Property_IRI_strong                              rdf:type html:Strong;
                                                              rdf:_1 ?RDF_Property_IRI_text.
      ?RDF_Property_IRI_text                                rdf:type html:TextElement;
                                                              html:fragment 'IRI: '.
      ?RDF_Property_IRI_a                                   rdf:type html:A;
                                                              html:href ?fullIRI;
                                                              rdf:_1 ?IRI_value.
      ?IRI_value                                              rdf:type html:TextElement;
                                                              html:fragment ?fullIRI.
      ?RDF_Property_definition_instance                     rdf:type html:TextElement;
                                                              html:fragment ?RDF_PropertyDefinition_text.
      ?manchester_syntax_instance                             rdf:type html:Aside;
                                                              html:class "note" ;
                                                              html:title "Manchester Syntax (Extended)";
                                                              rdf:_1 ?manchester_syntax_code_instance.
      ?manchester_syntax_code_instance                        rdf:type html:Code;
                                                              rdf:_1 ?manchester_table_instance.
      ?manchester_table_instance                              rdf:type html:Table;
                                                              rdf:_1 ?manchester_table_body_instance_RDF_Property.
      ?manchester_table_body_instance_RDF_Property          rdf:type html:TableBody;
                                                              rdf:_1 ?manchester_definition_tr_RDF_Property;
                                                              rdf:_2 ?manchester_definition_tr_RDF_Property_empty_row;
                                                              rdf:_3 ?manchester_domain_tr_RDF_Property;
                                                              rdf:_4 ?manchester_range_tr_RDF_Property;
                                                              rdf:_5 ?manchester_subproperty_tr_RDF_Property.
      ?manchester_definition_tr_RDF_Property                rdf:type html:Row;
                                                              rdf:_1 ?manchester_definition_RDF_Property_type_td;
                                                              rdf:_2 ?manchester_definition_RDF_Property_value_td.
      ?manchester_definition_RDF_Property_type_td           rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_definition_RDF_Property_type_text. 
      ?manchester_definition_RDF_Property_type_text         rdf:type html:TextElement;
                                                              html:fragment 'RDF_Property:'.
      ?manchester_definition_RDF_Property_value_td          rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_definition_RDF_Property_value_text.
      ?manchester_definition_RDF_Property_value_text        rdf:type html:TextElement;
                                                              html:fragment ?RDF_PropertyManchesterLabel.

      ?manchester_definition_tr_RDF_Property_empty_row      rdf:type html:Row;
                                                              rdf:_1 ?manchester_definition_RDF_Property_empty_td1;
                                                              rdf:_2 ?manchester_definition_RDF_Property_empty_td2.
      ?manchester_definition_RDF_Property_empty_td1         rdf:type html:DataCell.
      ?manchester_definition_RDF_Property_empty_td2         rdf:type html:DataCell.

      ?manchester_domain_tr_RDF_Property                    rdf:type html:Row;
                                                              rdf:_1 ?manchester_domain_tr_RDF_Property_type_td;
                                                              rdf:_2 ?manchester_domain_tr_RDF_Property_value_td.
      ?manchester_domain_tr_RDF_Property_type_td            rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_domain_tr_RDF_Property_type_text. 
      ?manchester_domain_tr_RDF_Property_type_text          rdf:type html:TextElement;
                                                              html:fragment 'Domain:'.
      ?manchester_domain_tr_RDF_Property_value_td           rdf:type html:DataCell;
                                                              rdf:_1 ?manchester_domain_tr_RDF_Property_value_text.
      ?manchester_domain_tr_RDF_Property_value_text         rdf:type html:TextElement;
                                                              html:fragment ?RDF_PropertyManchesterDomain.

      ?manchester_range_tr_RDF_Property                    rdf:type html:Row;
                                                             rdf:_1 ?manchester_range_tr_RDF_Property_type_td;
                                                             rdf:_2 ?manchester_range_tr_RDF_Property_value_td.
      ?manchester_range_tr_RDF_Property_type_td            rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_range_tr_RDF_Property_type_text. 
      ?manchester_range_tr_RDF_Property_type_text          rdf:type html:TextElement;
                                                             html:fragment 'Range:'.
      ?manchester_range_tr_RDF_Property_value_td           rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_range_tr_RDF_Property_value_text.
      ?manchester_range_tr_RDF_Property_value_text         rdf:type html:TextElement;
                                                             html:fragment ?RDF_PropertyManchesterRange.

      ?manchester_subproperty_tr_RDF_Property              rdf:type html:Row;
                                                             rdf:_1 ?manchester_subproperty_tr_RDF_Property_type_td;
                                                             rdf:_2 ?manchester_subproperty_tr_RDF_Property_value_td.
      ?manchester_subproperty_tr_RDF_Property_type_td      rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_subproperty_tr_RDF_Property_type_text. 
      ?manchester_subproperty_tr_RDF_Property_type_text    rdf:type html:TextElement;
                                                             html:fragment 'Subproperty:'.
      ?manchester_subproperty_tr_RDF_Property_value_td     rdf:type html:DataCell;
                                                             rdf:_1 ?manchester_subproperty_tr_RDF_Property_value_text.
      ?manchester_subproperty_tr_RDF_Property_value_text   rdf:type html:TextElement;
                                                             html:fragment ?RDF_PropertyManchesterSubPropertyOf.

      ?RDF_Property_linebreak_instance1                          rdf:type html:Br.
      ?RDF_Property_linebreak_instance2                          rdf:type html:Br.
      ?RDF_Property_linebreak_instance3                          rdf:type html:Br.
      ?RDF_Property_linebreak_instance5                          rdf:type html:Br.
      ?RDF_Property_linebreak_instance6                          rdf:type html:Br.
}
where  {

  # Get the template

  {?template rdf:type respec:RDF_Property.}

  # Get the sorted entities from the ontology including semantics
  
  {SELECT ?RDF_Property ?RDF_PropertyManchesterLabel_original ?RDF_PropertyManchesterLabel ?RDF_PropertyManchesterDomain ?RDF_PropertyManchesterRange ?RDF_PropertyManchesterSubPropertyOf ?RDF_PropertyDefinition_text (COUNT(?prevRDF_Property) + 1 AS ?member)
WHERE {
  ?RDF_Property a rdf:Property .
  ?RDF_Property manchester:label ?RDF_PropertyManchesterLabel_original .
  ?RDF_Property rdfs:isDefinedBy ?ontology.
  $this dct:subject ?ontology;
        respec:documentLanguage ?language.

  OPTIONAL{
  ?RDF_Property skos:definition ?RDF_PropertyDefinition_original.
  FILTER (LANG(?RDF_PropertyDefinition_original) = ?language)
  } 
  OPTIONAL{
  ?RDF_Property manchester:domain ?RDF_PropertyManchesterDomain.}
  OPTIONAL{
  ?RDF_Property manchester:range ?RDF_PropertyManchesterRange.}
  OPTIONAL{
  ?RDF_Property manchester:subPropertyOf ?RDF_PropertyManchesterSubPropertyOf.}
  
  BIND(function:escapeHTML(?RDF_PropertyManchesterLabel_original) as ?RDF_PropertyManchesterLabel)
  BIND(IF(BOUND(?RDF_PropertyDefinition_original), function:escapeHTML(?RDF_PropertyDefinition_original), "No definition provided by this ontology.") as ?RDF_PropertyDefinition_text)
   
  OPTIONAL {
    ?prevRDF_Property a rdf:Property .
    ?prevRDF_Property manchester:label ?prevLabel .
    FILTER(?prevLabel < ?RDF_PropertyManchesterLabel_original)
  }
}
  GROUP BY ?RDF_PropertyManchesterLabel_original ?RDF_PropertyManchesterLabel ?RDF_Property ?RDF_PropertyManchesterDomain ?RDF_PropertyManchesterRange ?RDF_PropertyManchesterSubPropertyOf ?RDF_PropertyDefinition_text 
  ORDER BY ?RDF_PropertyManchesterLabel_original
}

  BIND(IRI(CONCAT(str(rdf:),"_", str(?member))) as ?rdf_member)  
  BIND(IF(!BOUND(?RDF_Property), "This ontology does not define any RDF properties.", ?unboundDummy) as ?absenceOfRDF_PropertyDefinitions)

  # Establishing the full IRI of the RDF property.
  
  BIND(STR(?RDF_Property) as ?fullIRI)
  
  # Create identifiers - generic
  
  bind(IRI(CONCAT(STR(?template),'-instance')) as ?divDefinitionRDF_Property1Instance)
  bind(IRI(CONCAT(STR(?divDefinitionRDF_Property1Instance), '-', str(?member),'-1')) as ?divDefinitionRDF_Property2Instance)
  bind(IRI(CONCAT(STR(?divDefinitionRDF_Property2Instance), '-1')) as ?RDF_Property_title_instance_h2)
  bind(IRI(CONCAT(STR(?divDefinitionRDF_Property2Instance), '-2')) as ?RDF_Property_IRI_p)
  bind(IRI(CONCAT(STR(?divDefinitionRDF_Property2Instance), '-3')) as ?RDF_Property_linebreak_instance1)
  bind(IRI(CONCAT(STR(?divDefinitionRDF_Property2Instance), '-4')) as ?RDF_Property_definition_instance)
  bind(IRI(CONCAT(STR(?divDefinitionRDF_Property2Instance), '-5')) as ?RDF_Property_linebreak_instance2)
  bind(IRI(CONCAT(STR(?divDefinitionRDF_Property2Instance), '-6')) as ?RDF_Property_linebreak_instance3)
  bind(IRI(CONCAT(STR(?divDefinitionRDF_Property2Instance), '-7')) as ?manchester_syntax_instance)
  bind(IRI(CONCAT(STR(?RDF_Property_IRI_p), '-1')) as ?RDF_Property_IRI_strong)
  bind(IRI(CONCAT(STR(?RDF_Property_IRI_p), '-2')) as ?RDF_Property_IRI_a)
  bind(IRI(CONCAT(STR(?RDF_Property_IRI_strong), '-1')) as ?RDF_Property_IRI_text)
  bind(IRI(CONCAT(STR(?RDF_Property_IRI_a), '-1')) as ?IRI_value)
  bind(IRI(CONCAT(STR(?RDF_Property_title_instance_h2), '-1')) as ?RDF_Property_dfn_instance)
  bind(IRI(CONCAT(STR(?RDF_Property_dfn_instance), '-1')) as ?RDF_Property_title_text_instance)
    
  # Create identifiers - Manchester Syntax 

  bind(IRI(CONCAT(STR(?manchester_syntax_instance), '-1')) as ?manchester_syntax_code_instance)
  bind(IRI(CONCAT(STR(?manchester_syntax_code_instance), '-1')) as ?manchester_table_instance)
  bind(IRI(CONCAT(STR(?manchester_table_instance), '-1')) as ?manchester_table_body_instance_RDF_Property)

  bind(IRI(CONCAT(STR(?manchester_table_body_instance_RDF_Property), '-1')) as ?manchester_definition_tr_RDF_Property)
  bind(IRI(CONCAT(STR(?manchester_table_body_instance_RDF_Property), '-2')) as ?manchester_definition_tr_RDF_Property_empty_row)
  bind(IF(BOUND(?RDF_PropertyManchesterDomain),IRI(CONCAT(STR(?manchester_table_body_instance_RDF_Property), '-3')), ?unboundDummy) as ?manchester_domain_tr_RDF_Property )
  bind(IF(BOUND(?RDF_PropertyManchesterRange),IRI(CONCAT(STR(?manchester_table_body_instance_RDF_Property), '-4')), ?unboundDummy) as ?manchester_range_tr_RDF_Property )
  bind(IF(BOUND(?RDF_PropertyManchesterSubPropertyOf),IRI(CONCAT(STR(?manchester_table_body_instance_RDF_Property), '-5')),?unboundDummy) as ?manchester_subproperty_tr_RDF_Property )
  
  bind(IRI(CONCAT(STR(?manchester_definition_tr_RDF_Property), '-1')) as ?manchester_definition_RDF_Property_type_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_RDF_Property), '-2')) as ?manchester_definition_RDF_Property_value_td)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_RDF_Property_empty_row), '-1')) as ?manchester_definition_RDF_Property_empty_td1)
  bind(IRI(CONCAT(STR(?manchester_definition_tr_RDF_Property_empty_row), '-2')) as ?manchester_definition_RDF_Property_empty_td2)
  bind(IRI(CONCAT(STR(?manchester_definition_RDF_Property_type_td), '-1')) as ?manchester_definition_RDF_Property_type_text)
  bind(IRI(CONCAT(STR(?manchester_definition_RDF_Property_value_td), '-1')) as ?manchester_definition_RDF_Property_value_text)
  
  bind(IRI(CONCAT(STR(?manchester_domain_tr_RDF_Property), '-1')) as ?manchester_domain_tr_RDF_Property_type_td)
  bind(IRI(CONCAT(STR(?manchester_domain_tr_RDF_Property), '-2')) as ?manchester_domain_tr_RDF_Property_value_td)
  bind(IRI(CONCAT(STR(?manchester_domain_tr_RDF_Property_type_td), '-1')) as ?manchester_domain_tr_RDF_Property_type_text)
  bind(IRI(CONCAT(STR(?manchester_domain_tr_RDF_Property_value_td), '-1')) as ?manchester_domain_tr_RDF_Property_value_text)

  bind(IRI(CONCAT(STR(?manchester_range_tr_RDF_Property), '-1')) as ?manchester_range_tr_RDF_Property_type_td)
  bind(IRI(CONCAT(STR(?manchester_range_tr_RDF_Property), '-2')) as ?manchester_range_tr_RDF_Property_value_td)
  bind(IRI(CONCAT(STR(?manchester_range_tr_RDF_Property_type_td), '-1')) as ?manchester_range_tr_RDF_Property_type_text)
  bind(IRI(CONCAT(STR(?manchester_range_tr_RDF_Property_value_td), '-1')) as ?manchester_range_tr_RDF_Property_value_text)
  
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_RDF_Property), '-1')) as ?manchester_subproperty_tr_RDF_Property_type_td)
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_RDF_Property), '-2')) as ?manchester_subproperty_tr_RDF_Property_value_td)
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_RDF_Property_type_td), '-1')) as ?manchester_subproperty_tr_RDF_Property_type_text)
  bind(IRI(CONCAT(STR(?manchester_subproperty_tr_RDF_Property_value_td), '-1')) as ?manchester_subproperty_tr_RDF_Property_value_text)

}
""".

condition:Nodeshapes
  a sh:PropertyShape;
  skos:prefLabel 'The user has requested the specification of ontology nodeshapes in the document.'@en;
  sh:path respec:nodeshapes;
  sh:hasValue true.

rule:NodeShapes
  a sh:SPARQLRule;
  skos:prefLabel 'Node shapes rule'@en;
  rdfs:comment 'The node shapes rule creates a section of node shapes for the ontology in the document.'@en ;
  sh:condition condition:Nodeshapes;
  sh:construct """

prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/>
prefix manchester: <https://data.rijksfinancien.nl/manchester/model/def/>
prefix owl: <http://www.w3.org/2002/07/owl#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix respec: <https://respec.org/model/def/>
prefix schema: <http://schema.org/>
prefix sh: <http://www.w3.org/ns/shacl#>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
prefix vann: <http://purl.org/vocab/vann/>

construct {

  ?chapter                   rdf:type html:Div;
                             ?rdf_member ?section;
                             html:fragment ?absenceOfDefinitions.
  ?section                   rdf:type html:Section;
                             rdf:_1 ?title;
                             rdf:_2 ?IRI;
                             rdf:_3 ?linebreak1;
                             rdf:_4 ?definition;
                             rdf:_5 ?linebreak2;
                             rdf:_6 ?linebreak3;
                             rdf:_7 ?manchester_syntax.
  ?title                       rdf:type html:H2;
                               rdf:_1 ?dfn.
  ?dfn                            rdf:type html:Dfn;
                                  rdf:_1 ?title_text.
  ?title_text                     rdf:type html:TextElement;
                                  html:fragment ?entityManchesterLabel.
  ?IRI                                   rdf:type html:P;
                                         rdf:_1 ?IRI_strong;
                                         rdf:_2 ?IRI_a.
  ?IRI_strong                              rdf:type html:Strong;
                                           rdf:_1 ?IRI_text.
  ?IRI_text                                rdf:type html:TextElement;
                                           html:fragment 'IRI: '.
  ?IRI_a                                   rdf:type html:A;
                                           html:href ?fullIRI;
                                           rdf:_1 ?IRI_value_text.
  ?IRI_value_text                                         rdf:type html:TextElement;
                                                          html:fragment ?fullIRI.
  ?definition                     rdf:type html:TextElement;
                                  html:fragment ?entityDefinition.
  ?manchester_syntax                             rdf:type html:Aside;
                                                 html:class "note" ;
                                                 html:title "Manchester Syntax (Extended)";
                                                 rdf:_1 ?manchester_syntax_code.
  ?manchester_syntax_code                        rdf:type html:Code;
                                                 rdf:_1 ?manchester_syntax_table.
  ?manchester_syntax_table                              rdf:type html:Table;
                                                        rdf:_1 ?manchester_syntax_table_body_definition.
  ?manchester_syntax_table_body_definition          rdf:type html:TableBody;
                                                    rdf:_1 ?manchester_syntax_table_row_definition;
                                                    rdf:_2 ?emptyrow1;
                                                    rdf:_3 ?manchester_syntax_table_row_targetClass;
                                                    rdf:_4 ?manchester_syntax_table_row_targetSPARQL;
                                                    rdf:_5 ?manchester_syntax_table_row_targetSubject;
                                                    rdf:_6 ?manchester_syntax_table_row_targetObject.
  ?manchester_syntax_table_row_definition                rdf:type html:Row;
                                                         rdf:_1 ?manchester_syntax_definition_type;
                                                         rdf:_2 ?manchester_syntax_definition_value.
  ?manchester_syntax_definition_type           rdf:type html:DataCell;
                                               rdf:_1 ?manchester_syntax_definition_type_text.
  ?manchester_syntax_definition_type_text         rdf:type html:TextElement;
                                                  html:fragment 'Nodeshape:'.
  ?manchester_syntax_definition_value          rdf:type html:DataCell;
                                               rdf:_1 ?manchester_syntax_definition_value_text.
  ?manchester_syntax_definition_value_text        rdf:type html:TextElement;
                                                  html:fragment ?entityManchesterLabel.

  ?emptyrow1      rdf:type html:Row;
                  rdf:_1 ?emptycell1;
                  rdf:_2 ?emptycell2.
  ?emptycell1         rdf:type html:DataCell.
  ?emptycell2         rdf:type html:DataCell.

  ?manchester_syntax_table_row_targetClass                    rdf:type html:Row;
                                                         rdf:_1 ?manchester_syntax_definition_targetClass_type;
                                                         rdf:_2 ?manchester_syntax_definition_targetClass_value.
  ?manchester_syntax_definition_targetClass_type            rdf:type html:DataCell;
                                                       rdf:_1 ?manchester_syntax_definition_targetClass_type_text.
  ?manchester_syntax_definition_targetClass_type_text          rdf:type html:TextElement;
                                                          html:fragment 'TargetClass:'.
  ?manchester_syntax_definition_targetClass_value           rdf:type html:DataCell;
                                                       rdf:_1 ?manchester_syntax_definition_targetClass_value_text.
  ?manchester_syntax_definition_targetClass_value_text         rdf:type html:TextElement;
                                                          html:fragment ?entityManchesterTargetClass.

  ?manchester_syntax_table_row_targetSPARQL                    rdf:type html:Row;
                                                        rdf:_1 ?manchester_syntax_definition_targetSPARQL_type;
                                                        rdf:_2 ?manchester_syntax_definition_targetSPARQL_value.
  ?manchester_syntax_definition_targetSPARQL_type            rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_targetSPARQL_type_text.
  ?manchester_syntax_definition_targetSPARQL_type_text          rdf:type html:TextElement;
                                                         html:fragment 'SPARQLTarget:'.
  ?manchester_syntax_definition_targetSPARQL_value           rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_targetSPARQL_value_text.
  ?manchester_syntax_definition_targetSPARQL_value_text         rdf:type html:TextElement;
                                                         html:fragment ?entityManchesterTargetSPARQL.

  ?manchester_syntax_table_row_targetSubject              rdf:type html:Row;
                                                        rdf:_1 ?manchester_syntax_definition_targetSubject_type;
                                                        rdf:_2 ?manchester_syntax_definition_targetSubject_value.
  ?manchester_syntax_definition_targetSubject_type      rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_targetSubject_type_text.
  ?manchester_syntax_definition_targetSubject_type_text    rdf:type html:TextElement;
                                                         html:fragment 'TargetSubjectOf:'.
  ?manchester_syntax_definition_targetSubject_value     rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_targetSubject_value_text.
  ?manchester_syntax_definition_targetSubject_value_text   rdf:type html:TextElement;
                                                         html:fragment ?entityManchesterTargetSubject.

  ?manchester_syntax_table_row_targetObject              rdf:type html:Row;
                                                        rdf:_1 ?manchester_syntax_definition_targetObject_type;
                                                        rdf:_2 ?manchester_syntax_definition_targetObject_value.
  ?manchester_syntax_definition_targetObject_type      rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_targetObject_type_text.
  ?manchester_syntax_definition_targetObject_type_text    rdf:type html:TextElement;
                                                         html:fragment 'TargetObjectOf:'.
  ?manchester_syntax_definition_targetObject_value     rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_targetObject_value_text.
  ?manchester_syntax_definition_targetObject_value_text   rdf:type html:TextElement;
                                                         html:fragment ?entityManchesterTargetObject.


  ?linebreak1                          rdf:type html:Br.
  ?linebreak2                          rdf:type html:Br.
  ?linebreak3                          rdf:type html:Br.

}

  where  {
    # Get the template

    {?template rdf:type respec:NodeShape.}

    # Get the sorted entities from the ontology including semantics

    {
      select ?entity ?entityManchesterLabel_raw ?entityManchesterLabel ?entityManchesterTargetClass ?entityManchesterTargetSPARQL ?entityManchesterTargetSubject ?entityManchesterTargetObject ?entityDefinition (count(?prevEntity) + 1 as ?member)

      where {

        ?entity a sh:NodeShape .
        ?entity manchester:label ?entityManchesterLabel_raw .
        ?entity rdfs:isDefinedBy ?ontology.
        $this dct:subject ?ontology;
              respec:documentLanguage ?language.

        optional{
          ?entity skos:definition ?entityDefinition_raw.
          filter (lang(?entityDefinition_raw) = ?language)
        }

        optional{
          ?entity manchester:targetClass ?entityManchesterTargetClass.
        }

        optional{
          ?entity manchester:targetSPARQL ?entityManchesterTargetSPARQL.
        }

        optional{
          ?entity manchester:targetSubject ?entityManchesterTargetSubject.
        }

        optional{
          ?entity manchester:targetObject ?entityManchesterTargetObject.
        }

        bind(function:escapeHTML(?entityManchesterLabel_raw) as ?entityManchesterLabel)
        bind(if(bound(?entityDefinition_raw), coalesce(function:escapeHTML(?entityDefinition_raw)), "No definition provided by this ontology.") as ?entityDefinition)

        optional {
          ?prevEntity a sh:NodeShape .
          ?prevEntity manchester:label ?prevLabel .
          filter(?prevLabel < ?entityManchesterLabel_raw)
        }
      }
      group by ?entityManchesterLabel_raw ?entityManchesterLabel ?entity ?entityManchesterTargetClass ?entityManchesterTargetSPARQL ?entityManchesterTargetSubject ?entityManchesterTargetObject ?entityDefinition
      order by ?entityManchesterLabel_raw
    }

    bind(if(!bound(?entity), "This ontology does not define any nodeshapes.", ?unboundDummy) as ?absenceOfDefinitions)
    bind(iri(concat(str(rdf:),"_", str(?member))) as ?rdf_member)

    # Establishing the prefixed IRI of the entity.

    bind(str(?entity) as ?fullIRI)

    # Create identifiers - generic

    bind(iri(concat(str(?template),'-instance')) as ?chapter)
    bind(iri(concat(str(?chapter), '-', str(?member),'-1')) as ?section)
    bind(iri(concat(str(?section), '-1')) as ?title)
    bind(iri(concat(str(?section), '-2')) as ?IRI)
    bind(iri(concat(str(?section), '-3')) as ?linebreak1)
    bind(iri(concat(str(?section), '-4')) as ?definition)
    bind(iri(concat(str(?section), '-5')) as ?linebreak2)
    bind(iri(concat(str(?section), '-6')) as ?linebreak3)
    bind(iri(concat(str(?section), '-7')) as ?manchester_syntax)
    bind(iri(concat(str(?IRI), '-1')) as ?IRI_strong)
    bind(iri(concat(str(?IRI), '-2')) as ?IRI_a)
    bind(iri(concat(str(?IRI_strong), '-1')) as ?IRI_text)
    bind(iri(concat(str(?IRI_a), '-1')) as ?IRI_value_text)
    bind(iri(concat(str(?title), '-1')) as ?dfn)
    bind(iri(concat(str(?dfn), '-1')) as ?title_text)

    # Create identifiers - Manchester Syntax

    bind(iri(concat(str(?manchester_syntax), '-1')) as ?manchester_syntax_code)
    bind(iri(concat(str(?manchester_syntax_code), '-1')) as ?manchester_syntax_table)
    bind(iri(concat(str(?manchester_syntax_table), '-1')) as ?manchester_syntax_table_body_definition)

    bind(iri(concat(str(?manchester_syntax_table_body_definition), '-1')) as ?manchester_syntax_table_row_definition)
    bind(iri(concat(str(?manchester_syntax_table_body_definition), '-2')) as ?emptyrow1)
    bind(if(bound(?entityManchesterTargetClass),iri(concat(str(?manchester_syntax_table_body_definition), '-3')), ?unboundDummy) as ?manchester_syntax_table_row_targetClass )
    bind(if(bound(?entityManchesterTargetSPARQL),iri(concat(str(?manchester_syntax_table_body_definition), '-4')), ?unboundDummy) as ?manchester_syntax_table_row_targetSPARQL )
    bind(if(bound(?entityManchesterTargetSubject),iri(concat(str(?manchester_syntax_table_body_definition), '-5')),?unboundDummy) as ?manchester_syntax_table_row_targetSubject )
    bind(if(bound(?entityManchesterTargetObject),iri(concat(str(?manchester_syntax_table_body_definition), '-5')),?unboundDummy) as ?manchester_syntax_table_row_targetObject )

    bind(iri(concat(str(?manchester_syntax_table_row_definition), '-1')) as ?manchester_syntax_definition_type)
    bind(iri(concat(str(?manchester_syntax_table_row_definition), '-2')) as ?manchester_syntax_definition_value)
    bind(iri(concat(str(?emptyrow1), '-1')) as ?emptycell1)
    bind(iri(concat(str(?emptyrow1), '-2')) as ?emptycell2)
    bind(iri(concat(str(?manchester_syntax_definition_type), '-1')) as ?manchester_syntax_definition_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_value), '-1')) as ?manchester_syntax_definition_value_text)

    bind(iri(concat(str(?manchester_syntax_table_row_targetClass), '-1')) as ?manchester_syntax_definition_targetClass_type)
    bind(iri(concat(str(?manchester_syntax_table_row_targetClass), '-2')) as ?manchester_syntax_definition_targetClass_value)
    bind(iri(concat(str(?manchester_syntax_definition_targetClass_type), '-1')) as ?manchester_syntax_definition_targetClass_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_targetClass_value), '-1')) as ?manchester_syntax_definition_targetClass_value_text)

    bind(iri(concat(str(?manchester_syntax_table_row_targetSPARQL), '-1')) as ?manchester_syntax_definition_targetSPARQL_type)
    bind(iri(concat(str(?manchester_syntax_table_row_targetSPARQL), '-2')) as ?manchester_syntax_definition_targetSPARQL_value)
    bind(iri(concat(str(?manchester_syntax_definition_targetSPARQL_type), '-1')) as ?manchester_syntax_definition_targetSPARQL_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_targetSPARQL_value), '-1')) as ?manchester_syntax_definition_targetSPARQL_value_text)

    bind(iri(concat(str(?manchester_syntax_table_row_targetSubject), '-1')) as ?manchester_syntax_definition_targetSubject_type)
    bind(iri(concat(str(?manchester_syntax_table_row_targetSubject), '-2')) as ?manchester_syntax_definition_targetSubject_value)
    bind(iri(concat(str(?manchester_syntax_definition_targetSubject_type), '-1')) as ?manchester_syntax_definition_targetSubject_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_targetSubject_value), '-1')) as ?manchester_syntax_definition_targetSubject_value_text)

    bind(iri(concat(str(?manchester_syntax_table_row_targetObject), '-1')) as ?manchester_syntax_definition_targetObject_type)
    bind(iri(concat(str(?manchester_syntax_table_row_targetObject), '-2')) as ?manchester_syntax_definition_targetObject_value)
    bind(iri(concat(str(?manchester_syntax_definition_targetObject_type), '-1')) as ?manchester_syntax_definition_targetObject_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_targetObject_value), '-1')) as ?manchester_syntax_definition_targetObject_value_text)

  }
""".

condition:NamedIndividuals
  a sh:PropertyShape;
  skos:prefLabel 'The user has requested the specification of ontology named individuals in the document.'@en;
  sh:path respec:namedIndividuals;
  sh:hasValue true.

rule:NamedIndividuals
  a sh:SPARQLRule;
  skos:prefLabel 'Named individuals rule'@en;
  rdfs:comment 'The named individuals rule creates a section of named individuals for the ontology in the document.'@en ;
  sh:condition condition:NamedIndividuals;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/>
prefix manchester: <https://data.rijksfinancien.nl/manchester/model/def/>
prefix owl: <http://www.w3.org/2002/07/owl#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix respec: <https://respec.org/model/def/>
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
prefix vann: <http://purl.org/vocab/vann/>

construct {

  ?chapter                   rdf:type html:Div;
                             ?rdf_member ?section;
                             html:fragment ?absenceOfDefinitions.
  ?section                   rdf:type html:Section;
                             rdf:_1 ?title;
                             rdf:_2 ?IRI;
                             rdf:_3 ?linebreak1;
                             rdf:_4 ?definition;
                             rdf:_5 ?linebreak2;
                             rdf:_6 ?linebreak3;
                             rdf:_7 ?manchester_syntax.
  ?title                       rdf:type html:H2;
                               rdf:_1 ?dfn.
  ?dfn                            rdf:type html:Dfn;
                                  rdf:_1 ?title_text.
  ?title_text                     rdf:type html:TextElement;
                                  html:fragment ?entityManchesterLabel.
  ?IRI                                   rdf:type html:P;
                                         rdf:_1 ?IRI_strong;
                                         rdf:_2 ?IRI_a.
  ?IRI_strong                              rdf:type html:Strong;
                                           rdf:_1 ?IRI_text.
  ?IRI_text                                rdf:type html:TextElement;
                                           html:fragment 'IRI: '.
  ?IRI_a                                   rdf:type html:A;
                                           html:href ?fullIRI;
                                           rdf:_1 ?IRI_value_text.
  ?IRI_value_text                                         rdf:type html:TextElement;
                                                          html:fragment ?fullIRI.
  ?definition                     rdf:type html:TextElement;
                                  html:fragment ?entityDefinition.
  ?manchester_syntax                             rdf:type html:Aside;
                                                 html:class "note" ;
                                                 html:title "Manchester Syntax (Extended)";
                                                 rdf:_1 ?manchester_syntax_code.
  ?manchester_syntax_code                        rdf:type html:Code;
                                                 rdf:_1 ?manchester_syntax_table.
  ?manchester_syntax_table                              rdf:type html:Table;
                                                        rdf:_1 ?manchester_syntax_table_body_definition.
  ?manchester_syntax_table_body_definition          rdf:type html:TableBody;
                                                    rdf:_1 ?manchester_syntax_table_row_definition;
                                                    rdf:_2 ?emptyrow1;
                                                    rdf:_3 ?manchester_syntax_table_row_type;
                                                    rdf:_4 ?manchester_syntax_table_row_fact.
  ?manchester_syntax_table_row_definition                rdf:type html:Row;
                                                         rdf:_1 ?manchester_syntax_definition_type;
                                                         rdf:_2 ?manchester_syntax_definition_value.
  ?manchester_syntax_definition_type           rdf:type html:DataCell;
                                               rdf:_1 ?manchester_syntax_definition_type_text.
  ?manchester_syntax_definition_type_text         rdf:type html:TextElement;
                                                  html:fragment 'Named individual:'.
  ?manchester_syntax_definition_value          rdf:type html:DataCell;
                                               rdf:_1 ?manchester_syntax_definition_value_text.
  ?manchester_syntax_definition_value_text        rdf:type html:TextElement;
                                                  html:fragment ?entityManchesterLabel.

  ?emptyrow1      rdf:type html:Row;
                  rdf:_1 ?emptycell1;
                  rdf:_2 ?emptycell2.
  ?emptycell1         rdf:type html:DataCell.
  ?emptycell2         rdf:type html:DataCell.

  ?manchester_syntax_table_row_type                    rdf:type html:Row;
                                                         rdf:_1 ?manchester_syntax_definition_type_type;
                                                         rdf:_2 ?manchester_syntax_definition_type_value.
  ?manchester_syntax_definition_type_type            rdf:type html:DataCell;
                                                       rdf:_1 ?manchester_syntax_definition_type_type_text.
  ?manchester_syntax_definition_type_type_text          rdf:type html:TextElement;
                                                          html:fragment 'Types:'.
  ?manchester_syntax_definition_type_value           rdf:type html:DataCell;
                                                       rdf:_1 ?manchester_syntax_definition_type_value_text.
  ?manchester_syntax_definition_type_value_text         rdf:type html:TextElement;
                                                          html:fragment ?entityManchesterClass.

  ?manchester_syntax_table_row_fact                    rdf:type html:Row;
                                                        rdf:_1 ?manchester_syntax_definition_fact_type;
                                                        rdf:_2 ?manchester_syntax_definition_fact_value.
  ?manchester_syntax_definition_fact_type            rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_fact_type_text.
  ?manchester_syntax_definition_fact_type_text          rdf:type html:TextElement;
                                                         html:fragment 'Facts:'.
  ?manchester_syntax_definition_fact_value           rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_fact_value_text.
  ?manchester_syntax_definition_fact_value_text         rdf:type html:TextElement;
                                                         html:fragment ?entityManchesterFact.

  ?linebreak1                          rdf:type html:Br.
  ?linebreak2                          rdf:type html:Br.
  ?linebreak3                          rdf:type html:Br.

}

  where  {
    # Get the template

    {?template rdf:type respec:NamedIndividual.}

    # Get the sorted entities from the ontology including semantics

    {
      select ?entity ?entityManchesterLabel_raw ?entityManchesterLabel ?entityDefinition ?entityManchesterClass ?entityManchesterFact (count(?prevEntity) + 1 as ?member)

      where {

        ?entity manchester:syntax 'INDIVIDUAL' ;
                manchester:class ?entityManchesterClass ;
                manchester:label ?entityManchesterLabel_raw ;
                rdfs:isDefinedBy ?ontology.
        $this dct:subject ?ontology;
              respec:documentLanguage ?language.

        optional{
          ?entity skos:definition ?entityDefinition_raw.
          filter (lang(?entityDefinition_raw) = ?language)
        }

        optional{
          ?entity manchester:fact ?entityManchesterFact.
        }

        bind(function:escapeHTML(?entityManchesterLabel_raw) as ?entityManchesterLabel)
        bind(if(bound(?entityDefinition_raw), coalesce(function:escapeHTML(?entityDefinition_raw)), "No definition provided by this ontology.") as ?entityDefinition)

        optional {
          ?prevEntity manchester:syntax 'INDIVIDUAL';
                      manchester:label ?prevLabel .
          filter(?prevLabel < ?entityManchesterLabel_raw)
        }
      }
      group by ?entityManchesterLabel_raw ?entityManchesterLabel ?entity ?entityDefinition ?entityManchesterClass ?entityManchesterFact
      order by ?entityManchesterLabel_raw
    }

    bind(if(!bound(?entity), "This ontology does not define any named individuals.", ?unboundDummy) as ?absenceOfDefinitions)
    bind(iri(concat(str(rdf:),"_", str(?member))) as ?rdf_member)

    # Establishing the prefixed IRI of the entity.

    bind(str(?entity) as ?fullIRI)

    # Create identifiers - generic

    bind(iri(concat(str(?template),'-instance')) as ?chapter)
    bind(iri(concat(str(?chapter), '-', str(?member),'-1')) as ?section)
    bind(iri(concat(str(?section), '-1')) as ?title)
    bind(iri(concat(str(?section), '-2')) as ?IRI)
    bind(iri(concat(str(?section), '-3')) as ?linebreak1)
    bind(iri(concat(str(?section), '-4')) as ?definition)
    bind(iri(concat(str(?section), '-5')) as ?linebreak2)
    bind(iri(concat(str(?section), '-6')) as ?linebreak3)
    bind(iri(concat(str(?section), '-7')) as ?manchester_syntax)
    bind(iri(concat(str(?IRI), '-1')) as ?IRI_strong)
    bind(iri(concat(str(?IRI), '-2')) as ?IRI_a)
    bind(iri(concat(str(?IRI_strong), '-1')) as ?IRI_text)
    bind(iri(concat(str(?IRI_a), '-1')) as ?IRI_value_text)
    bind(iri(concat(str(?title), '-1')) as ?dfn)
    bind(iri(concat(str(?dfn), '-1')) as ?title_text)

    # Create identifiers - Manchester Syntax

    bind(iri(concat(str(?manchester_syntax), '-1')) as ?manchester_syntax_code)
    bind(iri(concat(str(?manchester_syntax_code), '-1')) as ?manchester_syntax_table)
    bind(iri(concat(str(?manchester_syntax_table), '-1')) as ?manchester_syntax_table_body_definition)

    bind(iri(concat(str(?manchester_syntax_table_body_definition), '-1')) as ?manchester_syntax_table_row_definition)
    bind(iri(concat(str(?manchester_syntax_table_body_definition), '-2')) as ?emptyrow1)
    bind(if(bound(?entityManchesterClass),iri(concat(str(?manchester_syntax_table_body_definition), '-3')), ?unboundDummy) as ?manchester_syntax_table_row_type )
    bind(if(bound(?entityManchesterFact),iri(concat(str(?manchester_syntax_table_body_definition), '-4')), ?unboundDummy) as ?manchester_syntax_table_row_fact )

    bind(iri(concat(str(?manchester_syntax_table_row_definition), '-1')) as ?manchester_syntax_definition_type)
    bind(iri(concat(str(?manchester_syntax_table_row_definition), '-2')) as ?manchester_syntax_definition_value)
    bind(iri(concat(str(?emptyrow1), '-1')) as ?emptycell1)
    bind(iri(concat(str(?emptyrow1), '-2')) as ?emptycell2)
    bind(iri(concat(str(?manchester_syntax_definition_type), '-1')) as ?manchester_syntax_definition_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_value), '-1')) as ?manchester_syntax_definition_value_text)

    bind(iri(concat(str(?manchester_syntax_table_row_type), '-1')) as ?manchester_syntax_definition_type_type)
    bind(iri(concat(str(?manchester_syntax_table_row_type), '-2')) as ?manchester_syntax_definition_type_value)
    bind(iri(concat(str(?manchester_syntax_definition_type_type), '-1')) as ?manchester_syntax_definition_type_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_type_value), '-1')) as ?manchester_syntax_definition_type_value_text)

    bind(iri(concat(str(?manchester_syntax_table_row_fact), '-1')) as ?manchester_syntax_definition_fact_type)
    bind(iri(concat(str(?manchester_syntax_table_row_fact), '-2')) as ?manchester_syntax_definition_fact_value)
    bind(iri(concat(str(?manchester_syntax_definition_fact_type), '-1')) as ?manchester_syntax_definition_fact_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_fact_value), '-1')) as ?manchester_syntax_definition_fact_value_text)

  }
""".

condition:ConceptSchemes
  a sh:PropertyShape;
  skos:prefLabel 'The user has requested the specification of ontology concept schemes in the document.'@en;
  sh:path respec:conceptSchemes;
            sh:hasValue true.

condition:ConceptSchemesFalse
  a sh:PropertyShape;
  skos:prefLabel 'The user has requested the specification of ontology concept schemes in the document.'@en;
  sh:path respec:conceptSchemes;
            sh:hasValue false.

condition:Concepts
  a sh:PropertyShape;
  skos:prefLabel 'The user has requested the specification of ontology concepts in the document.'@en;
  sh:path respec:concepts;
            sh:hasValue true.

rule:ConceptSchemes
  a sh:SPARQLRule;
  skos:prefLabel 'Concept schemes rule'@en;
  rdfs:comment 'The concept schemes rule creates a document section for concept schemes and their concepts as defined in the ontology.'@en ;
  sh:condition condition:ConceptSchemes, condition:Concepts;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/>
prefix manchester: <https://data.rijksfinancien.nl/manchester/model/def/>
prefix owl: <http://www.w3.org/2002/07/owl#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix respec: <https://respec.org/model/def/>
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
prefix vann: <http://purl.org/vocab/vann/>

construct {

  ?chapter                rdf:type html:Div;
                          html:fragment ?absenceOfConceptSchemeDefinitions;
                          ?rdf_memberScheme ?chapter_scheme.
  ?chapter_scheme         rdf:type html:Div;
                          rdf:_1 ?section_scheme;
                          ?rdf_member ?chapter_concept.
  ?section_scheme         rdf:type html:Section;
                          rdf:_1 ?title_scheme;
                          rdf:_2 ?IRI_scheme;
                          rdf:_3 ?linebreak1;
                          rdf:_4 ?definition_scheme;
                          rdf:_5 ?linebreak2;
                          rdf:_6 ?linebreak3;
                          rdf:_7 ?manchester_syntax_scheme.
  ?title_scheme           rdf:type html:H2;
                          rdf:_1 ?dfn_scheme.
  ?dfn_scheme                  rdf:type html:Dfn;
                               rdf:_1 ?title_text_scheme.
  ?title_text_scheme                     rdf:type html:TextElement;
                                  html:fragment ?conceptSchemeLabel.
  ?IRI_scheme                                   rdf:type html:P;
                                                rdf:_1 ?IRI_strong_scheme;
                                                rdf:_2 ?IRI_a_scheme.
  ?IRI_strong_scheme                              rdf:type html:Strong;
                                                  rdf:_1 ?IRI_text_scheme.
  ?IRI_text_scheme                                rdf:type html:TextElement;
                                                  html:fragment 'IRI: '.
  ?IRI_a_scheme                                   rdf:type html:A;
                                                  html:href ?conceptScheme_IRI;
                                                  rdf:_1 ?IRI_value_text_scheme.
  ?IRI_value_text_scheme                                         rdf:type html:TextElement;
                                                                 html:fragment ?conceptScheme_IRI.
  ?definition_scheme                     rdf:type html:TextElement;
                                         html:fragment ?cleanedSchemeDefinition.
  ?manchester_syntax_scheme                             rdf:type html:Aside;
                                                        html:class "note" ;
                                                        html:title "Manchester Syntax (Extended)";
                                                        rdf:_1 ?manchester_syntax_code_scheme.
  ?manchester_syntax_code_scheme                        rdf:type html:Code;
                                                        rdf:_1 ?manchester_syntax_table_scheme.
  ?manchester_syntax_table_scheme                              rdf:type html:Table;
                                                               rdf:_1 ?manchester_syntax_table_body_definition_scheme.
  ?manchester_syntax_table_body_definition_scheme          rdf:type html:TableBody;
                                                           rdf:_1 ?manchester_syntax_table_row_definition_scheme.
  ?manchester_syntax_table_row_definition_scheme                rdf:type html:Row;
                                                                rdf:_1 ?manchester_syntax_definition_type_scheme;
                                                                rdf:_2 ?manchester_syntax_definition_value_scheme.
  ?manchester_syntax_definition_type_scheme           rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_type_text_scheme.
  ?manchester_syntax_definition_type_text_scheme         rdf:type html:TextElement;
                                                         html:fragment 'Concept scheme:'.
  ?manchester_syntax_definition_value_scheme          rdf:type html:DataCell;
                                                      rdf:_1 ?manchester_syntax_definition_value_text_scheme.
  ?manchester_syntax_definition_value_text_scheme        rdf:type html:TextElement;
                                                         html:fragment ?conceptSchemeLabel.

  ?chapter_concept           rdf:type html:Div;
                             ?rdf_member ?section.
  ?section                   rdf:type html:Section;
                             rdf:_1 ?title;
                             rdf:_2 ?IRI;
                             rdf:_3 ?linebreak4;
                             rdf:_4 ?definition;
                             rdf:_5 ?linebreak5;
                             rdf:_6 ?linebreak6;
                             rdf:_7 ?manchester_syntax.
  ?title                       rdf:type html:H2;
                               rdf:_1 ?dfn.
  ?dfn                            rdf:type html:Dfn;
                                  rdf:_1 ?title_text.
  ?title_text                     rdf:type html:TextElement;
                                  html:fragment ?conceptLabel.
  ?IRI                                   rdf:type html:P;
                                         rdf:_1 ?IRI_strong;
                                         rdf:_2 ?IRI_a.
  ?IRI_strong                              rdf:type html:Strong;
                                           rdf:_1 ?IRI_text.
  ?IRI_text                                rdf:type html:TextElement;
                                           html:fragment 'IRI: '.
  ?IRI_a                                   rdf:type html:A;
                                           html:href ?concept_IRI;
                                           rdf:_1 ?IRI_value_text.
  ?IRI_value_text                                         rdf:type html:TextElement;
                                                          html:fragment ?concept_IRI.
  ?definition                     rdf:type html:TextElement;
                                  html:fragment ?conceptDefinition.
  ?manchester_syntax                             rdf:type html:Aside;
                                                 html:class "note" ;
                                                 html:title "Manchester Syntax (Extended)";
                                                 rdf:_1 ?manchester_syntax_code.
  ?manchester_syntax_code                        rdf:type html:Code;
                                                 rdf:_1 ?manchester_syntax_table.
  ?manchester_syntax_table                              rdf:type html:Table;
                                                        rdf:_1 ?manchester_syntax_table_body_definition.
  ?manchester_syntax_table_body_definition          rdf:type html:TableBody;
                                                    rdf:_1 ?manchester_syntax_table_row_definition;
                                                    rdf:_2 ?emptyrow1;
                                                    rdf:_3 ?manchester_syntax_table_row_inscheme.
  ?manchester_syntax_table_row_definition                rdf:type html:Row;
                                                         rdf:_1 ?manchester_syntax_definition_type;
                                                         rdf:_2 ?manchester_syntax_definition_value.
  ?manchester_syntax_definition_type           rdf:type html:DataCell;
                                               rdf:_1 ?manchester_syntax_definition_type_text.
  ?manchester_syntax_definition_type_text         rdf:type html:TextElement;
                                                  html:fragment 'Concept:'.
  ?manchester_syntax_definition_value          rdf:type html:DataCell;
                                               rdf:_1 ?manchester_syntax_definition_value_text.
  ?manchester_syntax_definition_value_text        rdf:type html:TextElement;
                                                  html:fragment ?conceptLabel.

  ?emptyrow1      rdf:type html:Row;
                  rdf:_1 ?emptycell1;
                  rdf:_2 ?emptycell2.
  ?emptycell1         rdf:type html:DataCell.
  ?emptycell2         rdf:type html:DataCell.

  ?manchester_syntax_table_row_inscheme                    rdf:type html:Row;
                                                           rdf:_1 ?manchester_syntax_definition_inscheme_type;
                                                           rdf:_2 ?manchester_syntax_definition_inscheme_value.
  ?manchester_syntax_definition_inscheme_type            rdf:type html:DataCell;
                                                         rdf:_1 ?manchester_syntax_definition_inscheme_type_text.
  ?manchester_syntax_definition_inscheme_type_text          rdf:type html:TextElement;
                                                            html:fragment 'In scheme:'.
  ?manchester_syntax_definition_inscheme_value           rdf:type html:DataCell;
                                                         rdf:_1 ?manchester_syntax_definition_inscheme_value_text.
  ?manchester_syntax_definition_inscheme_value_text         rdf:type html:TextElement;
                                                            html:fragment ?inSchemeLabel.


  ?linebreak4                          rdf:type html:Br.
  ?linebreak5                          rdf:type html:Br.
  ?linebreak6                          rdf:type html:Br.

}

  where  {
    # Get the template

    {?template rdf:type respec:Concept.}

    # Get the sorted concepts from the ontology including semantics

    {
      select ?conceptScheme ?concept ?conceptLabel_raw ?conceptLabel ?inSchemeLabel ?conceptDefinition (count(?prevConcept) + 2 as ?member)

      where {

        ?concept manchester:syntax 'CONCEPT';
                 manchester:label ?conceptLabel_raw ;
                 skos:inScheme ?conceptScheme;
                 rdfs:isDefinedBy ?ontology.
        ?conceptScheme manchester:label ?inSchemeLabel.
        $this dct:subject ?ontology;
              respec:documentLanguage ?language.

        optional{
          ?concept skos:definition ?conceptDefinition_raw.
          filter (lang(?conceptDefinition_raw) = ?language)
        }

        bind(function:escapeHTML(?conceptLabel_raw) as ?conceptLabel)
        bind(if(bound(?conceptDefinition_raw), coalesce(function:escapeHTML(?conceptDefinition_raw)), "No definition provided by this ontology.") as ?conceptDefinition)

        optional {
          ?prevConcept manchester:syntax 'CONCEPT';
                       manchester:label ?prevLabel ;
                       skos:inScheme ?conceptScheme.
          filter(?prevLabel < ?conceptLabel_raw)
        }
      }
      group by ?conceptScheme ?concept ?conceptLabel_raw ?conceptLabel ?inSchemeLabel ?conceptDefinition
      order by ?conceptScheme ?conceptLabel_raw
    }

    # Get the sorted concept schemes from the ontology including semantics
    {
      select ?conceptScheme ?conceptSchemeLabel ?cleanedSchemeDefinition (count(?prevConceptScheme) + 1 as ?memberScheme)
      where {
        ?conceptScheme manchester:syntax 'CONCEPTSCHEME';
                       manchester:label ?conceptSchemeLabel;
                       rdfs:isDefinedBy ?ontology.
        $this dct:subject ?ontology;
              respec:documentLanguage ?language.

        optional
        {
          ?conceptScheme skos:definition ?schemeDefinition.
          filter (lang(?schemeDefinition) = ?language)
        }

        bind(if(bound(?schemeDefinition), coalesce(function:escapeHTML(?schemeDefinition)), "No definition provided by this ontology.") as ?cleanedSchemeDefinition)

        optional
        {
          ?prevConceptScheme manchester:syntax 'CONCEPTSCHEME';
                             manchester:label ?prevSchemeLabel.
          filter(?prevSchemeLabel < ?conceptSchemeLabel)
        }
      }
      group by ?conceptSchemeLabel ?conceptScheme ?cleanedSchemeDefinition
      order by ?conceptScheme
    }

    bind(if(!bound(?concept), "This ontology does not define any concepts.", ?unboundDummy) as ?absenceOfDefinitions)
    bind(if(!bound(?conceptScheme), "This ontology does not define any concept schemes.", ?unboundDummy) as ?absenceOfConceptSchemeDefinitions)
    bind(iri(concat(str(rdf:),"_", str(?memberScheme))) as ?rdf_memberScheme)
    bind(iri(concat(str(rdf:),"_", str(?member))) as ?rdf_member)

    # Establishing the prefixed IRI of the concept and conceptscheme.

    bind(str(?concept) as ?concept_IRI)
    bind(str(?conceptScheme) as ?conceptScheme_IRI)

    # Create identifiers - conceptscheme

    bind(iri(concat(str(?template),'-instance')) as ?chapter)
    bind(iri(concat(str(?chapter), '-', str(?memberScheme))) as ?chapter_scheme)
    bind(iri(concat(str(?chapter_scheme),'-', str(?member))) as ?chapter_concept)
    bind(iri(concat(str(?chapter_scheme),'-1')) as ?section_scheme)
    bind(iri(concat(str(?section_scheme), '-1')) as ?title_scheme)
    bind(iri(concat(str(?section_scheme), '-2')) as ?IRI_scheme)
    bind(iri(concat(str(?section_scheme), '-3')) as ?linebreak1)
    bind(iri(concat(str(?section_scheme), '-4')) as ?definition_scheme)
    bind(iri(concat(str(?section_scheme), '-5')) as ?linebreak2)
    bind(iri(concat(str(?section_scheme), '-6')) as ?linebreak3)
    bind(iri(concat(str(?section_scheme), '-7')) as ?manchester_syntax_scheme)
    bind(iri(concat(str(?IRI_scheme), '-1')) as ?IRI_strong_scheme)
    bind(iri(concat(str(?IRI_scheme), '-2')) as ?IRI_a_scheme)
    bind(iri(concat(str(?IRI_strong_scheme), '-1')) as ?IRI_text_scheme)
    bind(iri(concat(str(?IRI_a_scheme), '-1')) as ?IRI_value_text_scheme)
    bind(iri(concat(str(?title_scheme), '-1')) as ?dfn_scheme)
    bind(iri(concat(str(?dfn_scheme), '-1')) as ?title_text_scheme)

    # Create identifiers - Manchester Syntax - conceptscheme

    bind(iri(concat(str(?manchester_syntax_scheme), '-1')) as ?manchester_syntax_code_scheme)
    bind(iri(concat(str(?manchester_syntax_code_scheme), '-1')) as ?manchester_syntax_table_scheme)
    bind(iri(concat(str(?manchester_syntax_table_scheme), '-1')) as ?manchester_syntax_table_body_definition_scheme)
    bind(iri(concat(str(?manchester_syntax_table_body_definition_scheme), '-1')) as ?manchester_syntax_table_row_definition_scheme)

    bind(iri(concat(str(?manchester_syntax_table_row_definition_scheme), '-1')) as ?manchester_syntax_definition_type_scheme)
    bind(iri(concat(str(?manchester_syntax_table_row_definition_scheme), '-2')) as ?manchester_syntax_definition_value_scheme)
    bind(iri(concat(str(?manchester_syntax_definition_type_scheme), '-1')) as ?manchester_syntax_definition_type_text_scheme)
    bind(iri(concat(str(?manchester_syntax_definition_value_scheme), '-1')) as ?manchester_syntax_definition_value_text_scheme)

    # Create identifiers - concept

    bind(iri(concat(str(?chapter_concept), '-', str(?member),'-1')) as ?section)
    bind(iri(concat(str(?section), '-1')) as ?title)
    bind(iri(concat(str(?section), '-2')) as ?IRI)
    bind(iri(concat(str(?section), '-3')) as ?linebreak4)
    bind(iri(concat(str(?section), '-4')) as ?definition)
    bind(iri(concat(str(?section), '-5')) as ?linebreak5)
    bind(iri(concat(str(?section), '-6')) as ?linebreak6)
    bind(iri(concat(str(?section), '-7')) as ?manchester_syntax)
    bind(iri(concat(str(?IRI), '-1')) as ?IRI_strong)
    bind(iri(concat(str(?IRI), '-2')) as ?IRI_a)
    bind(iri(concat(str(?IRI_strong), '-1')) as ?IRI_text)
    bind(iri(concat(str(?IRI_a), '-1')) as ?IRI_value_text)
    bind(iri(concat(str(?title), '-1')) as ?dfn)
    bind(iri(concat(str(?dfn), '-1')) as ?title_text)

    # Create identifiers - Manchester Syntax - concept

    bind(iri(concat(str(?manchester_syntax), '-1')) as ?manchester_syntax_code)
    bind(iri(concat(str(?manchester_syntax_code), '-1')) as ?manchester_syntax_table)
    bind(iri(concat(str(?manchester_syntax_table), '-1')) as ?manchester_syntax_table_body_definition)

    bind(iri(concat(str(?manchester_syntax_table_body_definition), '-1')) as ?manchester_syntax_table_row_definition)
    bind(iri(concat(str(?manchester_syntax_table_body_definition), '-2')) as ?emptyrow1)
    bind(if(bound(?inSchemeLabel),iri(concat(str(?manchester_syntax_table_body_definition), '-3')), ?unboundDummy) as ?manchester_syntax_table_row_inscheme )

    bind(iri(concat(str(?manchester_syntax_table_row_definition), '-1')) as ?manchester_syntax_definition_type)
    bind(iri(concat(str(?manchester_syntax_table_row_definition), '-2')) as ?manchester_syntax_definition_value)
    bind(iri(concat(str(?emptyrow1), '-1')) as ?emptycell1)
    bind(iri(concat(str(?emptyrow1), '-2')) as ?emptycell2)
    bind(iri(concat(str(?manchester_syntax_definition_type), '-1')) as ?manchester_syntax_definition_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_value), '-1')) as ?manchester_syntax_definition_value_text)

    bind(iri(concat(str(?manchester_syntax_table_row_inscheme), '-1')) as ?manchester_syntax_definition_inscheme_type)
    bind(iri(concat(str(?manchester_syntax_table_row_inscheme), '-2')) as ?manchester_syntax_definition_inscheme_value)
    bind(iri(concat(str(?manchester_syntax_definition_inscheme_type), '-1')) as ?manchester_syntax_definition_inscheme_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_inscheme_value), '-1')) as ?manchester_syntax_definition_inscheme_value_text)

  }
""".

rule:Concepts
  a sh:SPARQLRule;
  skos:prefLabel 'Concepts rule'@en;
  rdfs:comment 'The concepts rule creates a document section for the concepts as defined in the ontology.'@en ;
  sh:condition condition:ConceptSchemesFalse, condition:Concepts;
  sh:construct """
prefix dct: <http://purl.org/dc/terms/>
prefix dc:  <http://purl.org/dc/elements/1.1/>
prefix dom: <https://data.rijksfinancien.nl/dom/model/def/>
prefix function: <https://data.rijksfinancien.nl/html/model/function/>
prefix html: <https://data.rijksfinancien.nl/html/model/def/>
prefix manchester: <https://data.rijksfinancien.nl/manchester/model/def/>
prefix owl: <http://www.w3.org/2002/07/owl#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix respec: <https://respec.org/model/def/>
prefix schema: <http://schema.org/>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
prefix vann: <http://purl.org/vocab/vann/>

construct {

  ?chapter_concept           rdf:type html:Div;
                             html:fragment ?absenceOfDefinitions;
                             ?rdf_member ?section.
  ?section                   rdf:type html:Section;
                             rdf:_1 ?title;
                             rdf:_2 ?IRI;
                             rdf:_3 ?linebreak4;
                             rdf:_4 ?definition;
                             rdf:_5 ?linebreak5;
                             rdf:_6 ?linebreak6;
                             rdf:_7 ?manchester_syntax.
  ?title                       rdf:type html:H2;
                               rdf:_1 ?dfn.
  ?dfn                            rdf:type html:Dfn;
                                  rdf:_1 ?title_text.
  ?title_text                     rdf:type html:TextElement;
                                  html:fragment ?conceptLabel.
  ?IRI                                   rdf:type html:P;
                                         rdf:_1 ?IRI_strong;
                                         rdf:_2 ?IRI_a.
  ?IRI_strong                              rdf:type html:Strong;
                                           rdf:_1 ?IRI_text.
  ?IRI_text                                rdf:type html:TextElement;
                                           html:fragment 'IRI: '.
  ?IRI_a                                   rdf:type html:A;
                                           html:href ?concept_IRI;
                                           rdf:_1 ?IRI_value_text.
  ?IRI_value_text                                         rdf:type html:TextElement;
                                                          html:fragment ?concept_IRI.
  ?definition                     rdf:type html:TextElement;
                                  html:fragment ?conceptDefinition.
  ?manchester_syntax                             rdf:type html:Aside;
                                                 html:class "note" ;
                                                 html:title "Manchester Syntax (Extended)";
                                                 rdf:_1 ?manchester_syntax_code.
  ?manchester_syntax_code                        rdf:type html:Code;
                                                 rdf:_1 ?manchester_syntax_table.
  ?manchester_syntax_table                              rdf:type html:Table;
                                                        rdf:_1 ?manchester_syntax_table_body_definition.
  ?manchester_syntax_table_body_definition          rdf:type html:TableBody;
                                                    rdf:_1 ?manchester_syntax_table_row_definition;
                                                    rdf:_2 ?emptyrow1;
                                                    rdf:_3 ?manchester_syntax_table_row_inscheme.
  ?manchester_syntax_table_row_definition                rdf:type html:Row;
                                                         rdf:_1 ?manchester_syntax_definition_type;
                                                         rdf:_2 ?manchester_syntax_definition_value.
  ?manchester_syntax_definition_type           rdf:type html:DataCell;
                                               rdf:_1 ?manchester_syntax_definition_type_text.
  ?manchester_syntax_definition_type_text         rdf:type html:TextElement;
                                                  html:fragment 'Concept:'.
  ?manchester_syntax_definition_value          rdf:type html:DataCell;
                                               rdf:_1 ?manchester_syntax_definition_value_text.
  ?manchester_syntax_definition_value_text        rdf:type html:TextElement;
                                                  html:fragment ?conceptLabel.

  ?emptyrow1      rdf:type html:Row;
                  rdf:_1 ?emptycell1;
                  rdf:_2 ?emptycell2.
  ?emptycell1         rdf:type html:DataCell.
  ?emptycell2         rdf:type html:DataCell.

  ?manchester_syntax_table_row_inscheme                    rdf:type html:Row;
                                                           rdf:_1 ?manchester_syntax_definition_inscheme_type;
                                                           rdf:_2 ?manchester_syntax_definition_inscheme_value.
  ?manchester_syntax_definition_inscheme_type            rdf:type html:DataCell;
                                                         rdf:_1 ?manchester_syntax_definition_inscheme_type_text.
  ?manchester_syntax_definition_inscheme_type_text          rdf:type html:TextElement;
                                                            html:fragment 'In scheme:'.
  ?manchester_syntax_definition_inscheme_value           rdf:type html:DataCell;
                                                         rdf:_1 ?manchester_syntax_definition_inscheme_value_text.
  ?manchester_syntax_definition_inscheme_value_text         rdf:type html:TextElement;
                                                            html:fragment ?inSchemeLabel.


  ?linebreak4                          rdf:type html:Br.
  ?linebreak5                          rdf:type html:Br.
  ?linebreak6                          rdf:type html:Br.

}

  where  {
    # Get the template

    {?template rdf:type respec:Concept.}

    # Get the sorted concepts from the ontology including semantics

    {
      select ?conceptScheme ?concept ?conceptLabel_raw ?conceptLabel ?inSchemeLabel ?conceptDefinition (count(?prevConcept) + 2 as ?member)

      where {

        ?concept manchester:syntax 'CONCEPT';
                 manchester:label ?conceptLabel_raw ;
               
                 rdfs:isDefinedBy ?ontology.
        
        $this dct:subject ?ontology;
              respec:documentLanguage ?language.

        optional{
          ?concept skos:inScheme ?conceptScheme.
          ?conceptScheme manchester:label ?inSchemeLabel.
        }
          
        optional{
          ?concept skos:definition ?conceptDefinition_raw.
          filter (lang(?conceptDefinition_raw) = ?language)
        }

        bind(function:escapeHTML(?conceptLabel_raw) as ?conceptLabel)
        bind(if(bound(?conceptDefinition_raw), coalesce(function:escapeHTML(?conceptDefinition_raw)), "No definition provided by this ontology.") as ?conceptDefinition)

        optional {
          ?prevConcept manchester:syntax 'CONCEPT';
                       manchester:label ?prevLabel ;
                       skos:inScheme ?conceptScheme.
          filter(?prevLabel < ?conceptLabel_raw)
        }
      }
      group by ?conceptScheme ?concept ?conceptLabel_raw ?conceptLabel ?inSchemeLabel ?conceptDefinition
      order by ?conceptScheme ?conceptLabel_raw
    }

    bind(if(!bound(?concept), "This ontology does not define any concepts.", ?unboundDummy) as ?absenceOfDefinitions)
 
    bind(iri(concat(str(rdf:),"_", str(?member))) as ?rdf_member)

    # Establishing the prefixed IRI of the concept.

    bind(str(?concept) as ?concept_IRI)

    # Create identifiers - concept

    bind(iri(concat(str(?template),'-instance')) as ?chapter_concept)
    bind(iri(concat(str(?chapter_concept), '-', str(?member))) as ?section)
    bind(iri(concat(str(?section), '-1')) as ?title)
    bind(iri(concat(str(?section), '-2')) as ?IRI)
    bind(iri(concat(str(?section), '-3')) as ?linebreak4)
    bind(iri(concat(str(?section), '-4')) as ?definition)
    bind(iri(concat(str(?section), '-5')) as ?linebreak5)
    bind(iri(concat(str(?section), '-6')) as ?linebreak6)
    bind(iri(concat(str(?section), '-7')) as ?manchester_syntax)
    bind(iri(concat(str(?IRI), '-1')) as ?IRI_strong)
    bind(iri(concat(str(?IRI), '-2')) as ?IRI_a)
    bind(iri(concat(str(?IRI_strong), '-1')) as ?IRI_text)
    bind(iri(concat(str(?IRI_a), '-1')) as ?IRI_value_text)
    bind(iri(concat(str(?title), '-1')) as ?dfn)
    bind(iri(concat(str(?dfn), '-1')) as ?title_text)

    # Create identifiers - Manchester Syntax - concept

    bind(iri(concat(str(?manchester_syntax), '-1')) as ?manchester_syntax_code)
    bind(iri(concat(str(?manchester_syntax_code), '-1')) as ?manchester_syntax_table)
    bind(iri(concat(str(?manchester_syntax_table), '-1')) as ?manchester_syntax_table_body_definition)

    bind(iri(concat(str(?manchester_syntax_table_body_definition), '-1')) as ?manchester_syntax_table_row_definition)
    bind(iri(concat(str(?manchester_syntax_table_body_definition), '-2')) as ?emptyrow1)
    bind(if(bound(?inSchemeLabel),iri(concat(str(?manchester_syntax_table_body_definition), '-3')), ?unboundDummy) as ?manchester_syntax_table_row_inscheme )

    bind(iri(concat(str(?manchester_syntax_table_row_definition), '-1')) as ?manchester_syntax_definition_type)
    bind(iri(concat(str(?manchester_syntax_table_row_definition), '-2')) as ?manchester_syntax_definition_value)
    bind(iri(concat(str(?emptyrow1), '-1')) as ?emptycell1)
    bind(iri(concat(str(?emptyrow1), '-2')) as ?emptycell2)
    bind(iri(concat(str(?manchester_syntax_definition_type), '-1')) as ?manchester_syntax_definition_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_value), '-1')) as ?manchester_syntax_definition_value_text)

    bind(iri(concat(str(?manchester_syntax_table_row_inscheme), '-1')) as ?manchester_syntax_definition_inscheme_type)
    bind(iri(concat(str(?manchester_syntax_table_row_inscheme), '-2')) as ?manchester_syntax_definition_inscheme_value)
    bind(iri(concat(str(?manchester_syntax_definition_inscheme_type), '-1')) as ?manchester_syntax_definition_inscheme_type_text)
    bind(iri(concat(str(?manchester_syntax_definition_inscheme_value), '-1')) as ?manchester_syntax_definition_inscheme_value_text)

  }
""".

function:escapeHTML
    a sh:SPARQLFunction ;
    rdfs:comment "Escapes HTML characters in the input string." ;
    sh:parameter [
        sh:path function:input ;
        sh:datatype xsd:string ;
        sh:description "The input string to escape HTML characters from." ;
    ] ;
    sh:returnType xsd:string ;
    sh:select """
       SELECT ?result WHERE {
       BIND(replace(
                    replace(
                        replace(
                            replace(
                                replace(
                                    $input,
                                    '&', '&amp;', 'g'),
                                '<', '&lt;', 'g'),
                            '>', '&gt;', 'g'),
                        '\"', '&quot;', 'g'),
                    "\'", '&apos;', 'g')
                AS ?result).
        }
        """ .

function:getPrefixedIRI
    a sh:SPARQLFunction ;
    rdfs:comment "Gets prefixed IRI from full IRI." ;
    skos:example '''Assume an ontology with namespace "http://example.org/", prefix "ex" and a class "Person" as defined by this ontology. The function call will result in "ex:Person" for the IRI http://example.org/Person''';
    sh:parameter [
        sh:path function:IRI ;
        sh:datatype xsd:anyURI ;
        sh:description "The full IRI of a RDF resource as defined in an ontology." ;
    ] ;
    sh:returnType xsd:string ;
    sh:select """

PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX sh: <http://www.w3.org/ns/shacl#>
PREFIX vann: <http://purl.org/vocab/vann/>

SELECT ?result WHERE {

  # Establish the default full IRI of the resource, e.g. ex:Person would lead to http://example.org/Person.
  bind(str($IRI) as ?defaultFullIRI)

  # Establish possible namespaces
  optional
  {
    # Get the namespace declarations of the ontology
    {
      ?ontology sh:declare ?prefixDeclaration.
      ?prefixDeclaration sh:namespace ?namespace;
                         # e.g. "http://example.org/"
                         sh:prefix ?prefix.       # e.g. "ex"
    }
    union
    {
    # Get the namespace of the ontology itself
   
      ?ontology vann:preferredNamespaceUri ?namespace;
                # e.g. "http://example.org/"
                vann:preferredNamespacePrefix ?prefix.  # e.g. "ex"
    }
    # Establish the full IRI of the resource, e.g. ex:Person would lead to http://example.org/Person.
    bind(str($IRI) as ?fullIRI)  
    
    # Select one of the namespaces that match with the namespace of the resource
    filter(strstarts(?fullIRI, str(?namespace))) # e.g. "http://example.org/"

    # Establish the local name
    bind(strafter(?fullIRI, str(?namespace)) as ?localName) # e.g. "Person"

    # Establish the prefixed IRI if possible
    bind(concat(str(?prefix),":",?localName) as ?prefixedIRI)
  }
  # Establish result, either a prefixed IRI or the full IRI
  bind(coalesce(?prefixedIRI, ?defaultFullIRI) as ?result)
}
  """ .